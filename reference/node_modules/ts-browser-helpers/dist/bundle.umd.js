(function(s,p){typeof exports=="object"&&typeof module<"u"?p(exports):typeof define=="function"&&define.amd?define(["exports"],p):(s=typeof globalThis<"u"?globalThis:s||self,p(s["ts-browser-helpers"]={}))})(this,function(s){"use strict";/**
 * @license
 * ts-browser-helpers v0.16.3
 * Copyright 2022-2025 repalash <palash@shaders.app>
 * MIT License
 * See ./dependencies.txt for bundled third-party dependencies and licenses.
 */class p{constructor(){this._eventListeners={},this.dispatchEvent=this.dispatchEvent.bind(this),this.addEventListener=this.addEventListener.bind(this),this.removeEventListener=this.removeEventListener.bind(this),this.hasEventListener=this.hasEventListener.bind(this)}addEventListener(e,t){const i=this._eventListeners;i[e]===void 0&&(i[e]=[]),i[e].includes(t)||i[e].push(t)}hasEventListener(e,t){const i=this._eventListeners;return i[e]!==void 0&&i[e].includes(t)}removeEventListener(e,t){const r=this._eventListeners[e];if(r!==void 0){const o=r.indexOf(t);o!==-1&&r.splice(o,1)}}dispatchEvent(e){const i=this._eventListeners[e.type];if(i!==void 0){e.target=this;const r=i.slice(0);for(let o=0,a=r.length;o<a;o++)r[o].call(this,e)}}}async function K(n){return new Promise(e=>setTimeout(e,Math.max(0,n)))}function y(){return(typeof performance>"u"?Date:performance).now()}class V extends p{constructor(){super(...arguments),this._onPointerDown=e=>{if(e.button!==0||!this._element)return;this._pointerUp=void 0;const t=e.clientX/this._element.clientWidth*2-1,i=-(e.clientY/this._element.clientHeight)*2+1,r=y();this._pointerDown={x:t,y:i,time:r},this._pointer=this._pointerDown,this.dispatchEvent({type:"dragStart",pointer:this._pointerDown})},this._onPointerMove=e=>{if(!this._pointerDown||!this._pointer||!this._element)return;const t=e.clientX/this._element.clientWidth*2-1,i=-(e.clientY/this._element.clientHeight)*2+1,r=y();this.dispatchEvent({type:"drag",pointer:this._pointer,drag:{x:t-this._pointerDown.x,y:i-this._pointerDown.y,time:r-this._pointerDown.time},delta:{x:t-this._pointer.x,y:i-this._pointer.y,time:r-this._pointer.time}}),this._pointer={x:t,y:i,time:y()},e.buttons%2===0&&this._onPointerUp(e)},this._onPointerUp=e=>{if(e.button!==0||!this._pointerDown||!this._element)return;const t=e.clientX/this._element.clientWidth*2-1,i=-(e.clientY/this._element.clientHeight)*2+1,r=y();this._pointerUp={x:t,y:i,time:r},this.dispatchEvent({type:"dragEnd",pointer:this._pointerUp,drag:{x:this._pointerUp.x-this._pointerDown.x,y:this._pointerUp.y-this._pointerDown.y,time:this._pointerUp.time-this._pointerDown.time}}),this._pointerDown=void 0,this._pointer=void 0}}get element(){return this._element}set element(e){this._element!==e&&(this._element&&this._removeElement(),this._element=e,this._element&&this._addElement())}_removeElement(){var e,t,i,r,o;(e=this._element)==null||e.removeEventListener("pointerdown",this._onPointerDown),(t=this._element)==null||t.removeEventListener("pointermove",this._onPointerMove),(i=this._element)==null||i.removeEventListener("pointerup",this._onPointerUp),(r=this._element)==null||r.removeEventListener("pointercancel",this._onPointerUp),(o=this._element)==null||o.removeEventListener("pointerout",this._onPointerUp)}_addElement(){var e,t,i,r,o;(e=this._element)==null||e.addEventListener("pointerdown",this._onPointerDown),(t=this._element)==null||t.addEventListener("pointermove",this._onPointerMove),(i=this._element)==null||i.addEventListener("pointerup",this._onPointerUp),(r=this._element)==null||r.addEventListener("pointercancel",this._onPointerUp),(o=this._element)==null||o.addEventListener("pointerout",this._onPointerUp)}dispose(){this.element=void 0}}/*!
 * Fork Of -
 * JavaScript Undo Manager 1.0.0
 * Simple JavaScript undo/redo command manager supporting transactions with no dependencies.
 *
 * Copyright: Alexey Grinko, 2017
 * Git repository: https://github.com/agrinko/js-undo-manager.git
 *
 * @license MIT - https://opensource.org/licenses/MIT
 *
 * Changes -
 * 1. Added presets commands
 * 2. Port to TypeScript
 * 3. Remove transactions
 */class J{constructor(e){this.options={limit:500,debug:!1,bindHotKeys:!1},this.enabled=!0,this.presets={},this._keyDown=t=>{if(!this.enabled)return;const i=t.ctrlKey||t.metaKey;t.code==="KeyZ"&&i&&!t.shiftKey?this.undo():(t.code==="KeyZ"&&i&&t.shiftKey||t.code==="KeyY"&&t.ctrlKey)&&this.redo()},Object.assign(this.options,e),this.limit=e.limit,this.options=e,this.reset(),e.bindHotKeys&&this.bindHotKeys(),this.log(`Initialized with stack limit of ${this.limit} commands`)}bindHotKeys(){return this.log("Bound 'undo' and 'redo' actions to 'Ctrl/Cmd+Z', 'Ctrl+Y' & 'Ctrl/Cmd+Shift+Z' hot keys"),(this.options.hotKeyRoot??document).addEventListener("keydown",this._keyDown),this}dispose(){return(this.options.hotKeyRoot??document).removeEventListener("keydown",this._keyDown),this.reset()}record(e){return this.enabled?(this._record(e),this):this}replaceLast(e){const t=this.peek();if(t)return this.log("replace",t,"with",e),this.stack[this.sp]=e,this}execute(e){if(!this.enabled)return;let t=this._rc(e),i=t.redo;return this.record.apply(this,t),this.log("Executing function..."),i.apply(e),this}_rc(e){if(e.type){const t=this.presets[e.type];if(typeof t=="function")return t(e);throw console.error(e,t,this.presets),new Error("Preset command not found")}else return e}_record(e){this.enabled&&(this.log("Recording command",e),this._rebase(),this.stack.push(e),this.sp++,this._keepLimit())}_rebase(){this.canRedo()&&(this.stack.length=this.sp+1)}_keepLimit(){if(this.stack.length<=this.limit)return;let e=this.stack.length-this.limit;this.log("Stack size reached its limit: ${this.limit} commands. Cutting off most old commands..."),e===1?this.stack.shift():this.stack.splice(0,e),this.sp-=e}undo(){if(!this.canUndo())return this;let e=this.stack[this.sp];return this.log("undo"),this.sp--,this._rc(e).undo(),this}canUndo(){return this.sp>=0&&this.enabled}peek(){return this.canUndo()?this.stack[this.sp]:null}redo(){if(!this.canRedo())return this;let e=this.stack[this.sp+1];return this.log("redo"),this.sp++,this._rc(e).redo(),this}canRedo(){return this.sp<this.stack.length-1&&this.enabled}peekForward(){return this.canRedo()?this.stack[this.sp+1]:null}setLimit(e){let t=this.stack.length-this.sp-1;if(e<1||typeof e!="number")throw new TypeError(`JSUndoManager.setLimit(): unexpected argument limit=${e}. Should be a positive number`);return e<t?console.warn(`JSUndoManager.setLimit(): cannot set stack limit (${e}) less than the number of 'redoable' commands (${t})`):(this.limit=Math.floor(e),this._keepLimit()),this}reset(){return this.log("reset"),this.stack=[],this.sp=-1,this}isEmpty(){return!this.stack.length}isFull(){return this.stack.length===this.limit}getSize(){return this.stack.length}log(e,...t){this.options.debug&&console.log(`Command Manager: ${e}`,...t)}}/* @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const g=class g{constructor(e=g.DECAY_MILLISECONDS){this.velocity=0,this.naturalFrequency=0,this.setDecayTime(e)}setDecayTime(e){this.naturalFrequency=1/Math.max(g.MIN_DECAY_MILLISECONDS,e)}update(e,t,i,r){const o=2e-4*this.naturalFrequency;if(e==null||r===0||e===t&&this.velocity===0)return t;if(i<0)return e;const a=e-t,c=this.velocity+this.naturalFrequency*a,l=a+i*c,f=Math.exp(-this.naturalFrequency*i),d=(c-this.naturalFrequency*l)*f,A=-this.naturalFrequency*(d+c*f);return Math.abs(d)<o*Math.abs(r)&&A*a>=0?(this.velocity=0,t):(this.velocity=d,t+l*f)}};g.SETTLING_TIME=1e4,g.MIN_DECAY_MILLISECONDS=.001,g.DECAY_MILLISECONDS=50;let E=g;function G(){const n=document.createElementNS("http://www.w3.org/1999/xhtml","canvas");return n.style.display="block",n}function X({innerHTML:n="",id:e,classList:t,addToBody:i=!0,elementTag:r="div"}){const o=document.createElement(r);return e&&(o.id=e),o.innerHTML=n,t&&o.classList.add(...t),i&&document.body.appendChild(o),o}async function D(n){return new Promise((e,t)=>{const i=new Image;i.onload=()=>e(i),i.onerror=t,i.crossOrigin="anonymous",i.decoding="sync",i.src=n})}function O(n,e=document.head){const t=document.createElement("style");return t.type="text/css",t.innerText=n,e==null||e.appendChild(t),t}async function Q(n,e=document.head){return new Promise((t,i)=>{const r=document.createElement("script");r.setAttribute("src",n),r.addEventListener("load",()=>t(r)),r.addEventListener("error",i),e.appendChild(r)})}async function Z(n,e){var i;n.innerHTML=e;const t=n.getElementsByTagName("script");for(let r=0;r<t.length;r++){const o=t[r],a=P(o);let c=!1;await new Promise(l=>{a.onload=l,a.onerror=()=>{c=!0,l(void 0)}}),!c&&((i=o.parentNode)==null||i.replaceChild(a,o))}}function P(n,e){e=e??document.createElement("script"),e.type=n.type||"text/javascript",e.text=n.text;for(let t=0;t<n.attributes.length;t++){const i=n.attributes[t];e.setAttribute(i.name,i.value)}return e}function j(n){if(!window)return console.warn("window is required"),"";let e="";const t=new Uint8Array(n),i=t.byteLength;for(let r=0;r<i;r++)e+=String.fromCharCode(t[r]);return window.btoa(e)}function ee(n){if(!window)return console.warn("window is required"),new Uint8Array(0);const e=window.atob(n),t=e.length,i=new Uint8Array(t);for(let r=0;r<t;r++)i[r]=e.charCodeAt(r);return i.buffer}const I={Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array};function te(n,e){return new I[n](e)}function ne(n){return n.replace(/\w\S*/g,function(e){return e.charAt(0).toUpperCase()+e.substr(1).toLowerCase()})}function ie(n){return n.replace(/([-_][a-z])/ig,e=>e.toUpperCase().replace("-","").replace("_",""))}function re(n){if(!n||n===""||n.match(/__MACOSX\/.*\._/))return"";n=n.replace(/\?.*$/,"");const e=n.split(/[\\/]/).pop()??"",t=e.lastIndexOf(".");return e===""||t<1?"":e.slice(t+1)}function se(n){return n.substring(n.lastIndexOf("/")+1)}function M(n){return n.replace(/([.*+?^=!:${}()|[\]/\\])/g,"\\$1")}function h(n,e,t){return n.replace(new RegExp(M(e),"g"),t)}function oe(n,e,t,{replaceAll:i=!1,prepend:r=!1,append:o=!1,notFoundCallback:a=()=>{}}={}){if(a&&!n.includes(e))return a(),n;let c=t;return r?c=t+e:o&&(c=e+t),i?n.replaceAll(e,c):n.replace(e,c)}function ae(n){return n.sort(),n[0].split("").map((e,t)=>n[n.length-1][t]===e?e:"\0").join("").split("\0").at(0)||""}const ce=(n,...e)=>String.raw({raw:n},...e),R=(n,...e)=>String.raw({raw:n},...e),le=(n,...e)=>String.raw({raw:n},...e),F=(n,...e)=>{let t=String.raw({raw:n},...e);return t=h(t,"%","%25"),t=h(t,"> <","><"),t=h(t,"; }",";}"),t=h(t,"<","%3c"),t=h(t,">","%3e"),t=h(t,'"',"'"),t=h(t,"#","%23"),t=h(t,"{","%7b"),t=h(t,"}","%7d"),t=h(t,"|","%7c"),t=h(t,"^","%5e"),t=h(t,"`","%60"),t=h(t,"@","%40"),t=h(t,"&","&amp;"),t=h(t,`
`,"%0A"),"data:image/svg+xml;charset=UTF-8,"+t};function ue(n=document.head){return O(R`
      ::-webkit-scrollbar
      {
        width: 8px;  /* for vertical scrollbars */
        height: 8px; /* for horizontal scrollbars */
      }
      ::-webkit-scrollbar-track
      {
        background: rgba(64, 64, 64, 0.4);
        border-radius: 6px;
      }
      ::-webkit-scrollbar-thumb
      {
        background: rgba(128, 128, 128, 0.2);
        border-radius: 6px;
      }
      ::-webkit-scrollbar-corner {background: rgba(0,0,0,0.5);}
    `,n)}function B(n,e){const t=window.URL.createObjectURL(n),i=document.createElement("a");i.style.display="none",i.href=t,i.download=e,document.body.appendChild(i),i.click(),setTimeout(()=>{document.body.removeChild(i),window.URL.revokeObjectURL(t)},1e3)}async function $(n){return new Promise((e,t)=>{const i=new FileReader;i.onload=r=>e(i.result),i.onerror=r=>t(i.error),i.onabort=r=>t(new Error("Read aborted")),i.readAsDataURL(n)})}function he(n,e){return B(n,e??n.name)}async function fe(n=!1,e=!1,t){const i=document.createElement("input");i.type="file",i.multiple=n,i.accept=t||"*",i.webkitdirectory=e,i.style.display="none",document.body.appendChild(i),i.click();const r=await new Promise(o=>{i.onchange=a=>{o(Array.from(i.files||[]))}});return document.body.removeChild(i),r}function de(){let n=!1;return function(e){(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino|android|ipad|playbook|silk/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(e.substr(0,4)))&&(n=!0)}(navigator.userAgent||navigator.vendor||window.opera),n}function me(n){return n<.04045?n*.0773993808:Math.pow(n*.9478672986+.0521327014,2.4)}function ge(n){return n<.0031308?n*12.92:1.055*Math.pow(n,.41666)-.055}function pe(n,e=1,t=1){const i=document.createElement("canvas");i.width=e,i.height=t;const r=i.getContext("2d");r.fillStyle="#"+n,r.fillRect(0,0,e,t);const o=i.toDataURL();return i.remove(),o}function N(n,e){let t;do t=Object.getOwnPropertyDescriptor(n,e);while(!t&&(n=Object.getPrototypeOf(n)));return t}function x(n,e,t=!0,i=!1){const r=N(n,e);return!!(r!=null&&r.set)||t&&(r==null?void 0:r.writable)!==!1&&(r==null?void 0:r.get)===void 0||i&&!r}function S(n,e,t,i=!0,r=!1){return n&&x(n,e,i,r)?(n[e]=t,!0):!1}function we(n,...e){return typeof n=="function"&&(n=n(...e)),n}function ye(n,e,t){for(const i of t){const r=n[i];r!==void 0&&S(e,i,r,!0)}return e}function ve(n,e){for(const t of e)if(!n.includes(t))return!1;return!0}function H(n,e){for(let t=n.length-1;t>=0;t--)if(e(n[t]))return t;return-1}function be(n,e){return function(...t){return n(),e&&e.call(this,...t)}}function Ce(n,e){return function(...t){return n(...t),e&&e.call(this,...t)}}function Ee(n,e,t=!1){for(typeof n=="string"&&(n=n.split("."));n.length>0;){if(!e)return e;const i=n.splice(0,1)[0];if(!(i.length<1))if(Array.isArray(e))e=e[parseInt(i)];else if(typeof e=="object"&&i in e)e=e[i];else{if(t)throw new Error("invalid access, check "+i+" in "+e);return}}return e}function Se(n,e){return Object.keys(n).find(t=>n[t]===e)}function v(n,e){return Object.hasOwn?Object.hasOwn(n,e):n.hasOwnProperty(e)}function ke(n,e,t=!0){const i=t?n:{},r=Object.keys(n);for(const o of r)i[o]=e(n[o],o);return i}function k(n,e){return Object.fromEntries(Object.entries(n).map(t=>e(t)))}const _={priority:1/0,serialize:(n,e)=>k(n,([t,i])=>[t,m.Serialize(i,e,!1)]),deserialize:(n,e,t)=>Object.assign(e||{},k(n,([i,r])=>[i,m.Deserialize(r,e==null?void 0:e[i],t,!1)])),isType:n=>(n.constructor||Object)===Object},u=class u{static GetSerializer(e){return u.Serializers.find(t=>t.isType(e))}static RegisterSerializer(...e){for(const t of e){const i=t.priority??1e10,r=H(u.Serializers,o=>o.priority!==void 0&&o.priority<i);r>=0?u.Serializers.splice(r+1,0,t):u.Serializers.push(t)}}static UnregisterSerializer(...e){for(const t of e){const i=u.Serializers.indexOf(t);i>=0&&u.Serializers.splice(i,1)}}static Serialize(e,t,i=!1){if(typeof e=="function")return;if(!i){const a=u.GetSerializer(e);if(a)return a.serialize(e,t);if(typeof e.toJSON=="function"){const c=e.toJSON(t,!0);return e.serializableClassId&&c&&(c.serializableClassId=e.serializableClassId),c}}let r=e.constructor??Object;const o={};for(;r&&r!==Object;){const a=u.TypeMap.get(r)??[];for(const[c,l]of a)o[c]=u.Serialize(e[l],t,!1);r=Object.getPrototypeOf(r)}return e.serializableClassId&&(o.serializableClassId=e.serializableClassId),o}static Deserialize(e,t,i,r=!1){if(e===void 0||t===e)return t;if(e&&typeof e=="object"&&(e.constructor||Object)===Object&&e.resource&&typeof e.resource=="string"&&e.uuid){const a=i==null?void 0:i[e.resource];if(a){if(e=a[e.uuid],typeof e=="object"&&(e.__useCount=e.__useCount?e.__useCount+1:1),e||console.warn(`Resource ${e.resource} with uuid ${e.uuid} not found`),t===e)return t;if(e&&typeof e=="object"){if((e.constructor||Object)!==Object)return t&&console.warn("replacing object",t,"with deserialized object from meta",e),e;console.error("Deserialize; meta should only have class instances, not js objects",e,t,i)}}else return console.warn(`Resource ${e.resource} not found`),t}if(e&&typeof e=="object"&&(e.constructor||Object)!==Object&&!Array.isArray(e)&&!e.serializableClassId){if(e instanceof Blob)return e;console.warn("Data might already be deserialized. It will be cloned, or copied to source",e,"source",t,e.constructor,e.constructor!==Object)}if(e&&typeof e=="object")if(e.serializableClassId&&(!t||t.serializableClassId!==e.serializableClassId)){const a=u.SerializableClasses.get(e.serializableClassId);a&&(a.DataInConstructor?t=new a(e):t=new a)}else(e.constructor||Object)===Object&&!t?t={}:Array.isArray(e)&&!t&&(t=[]);if(typeof t=="function")return console.error("cannot deserialize a function",t,e),t;if(!r){const a=u.GetSerializer(e);if(a&&a!==_)return a.deserialize(e,t,i)}if(!e||t===void 0||t===null||typeof t!="object")return e;if(!r&&typeof(t==null?void 0:t.fromJSON)=="function")return t.fromJSON(e,i,!0),t;let o=t.constructor??Object;if(o===Object)return _.deserialize(e,t,i);for(;o&&o!==Object;){const a=u.TypeMap.get(o)??[];for(const[c,l]of a){const f=t[l],d=u.Deserialize(e[c],f,i,!1);d!==f&&S(t,l,d,!0)}o=Object.getPrototypeOf(o)}return t}};u.TypeMap=new Map,u.SerializableClasses=new Map,u.Serializers=[{priority:0,isType:e=>Array.isArray(e),serialize:(e,t)=>e.map(i=>u.Serialize(i,t,!1)),deserialize:(e,t,i)=>{const r=e.length;Array.isArray(t)||(t=[]);for(let o=0;o<r;o++){const a=e[o],c=t.length>o?u.Deserialize(a,t[o],i,!1):u.Deserialize(a,void 0,i,!1);t.length<=o?t.push(c):t[o]=c}return t}},{priority:0,isType:e=>!e||typeof e!="object",serialize:e=>{if(e&&typeof e=="number"){if(e===1/0)return"Infinity";if(e===-1/0)return"-Infinity";if(isNaN(e))return"NaN"}return e},deserialize:(e,t)=>{if(typeof t=="number"){if(e==="Infinity")return 1/0;if(e==="-Infinity")return-1/0;if(e==="NaN")return NaN;if(typeof e=="number"||!e)return e}return e}},_];let m=u;const w=class w{static callFunction(e,t,i=[]){if(!t)return e(...i);if(e.name&&t[e.name]===e)return e.call(t,...i);w.methodMap.has(t)||w.methodMap.set(t,new WeakMap);const r=w.methodMap.get(t);if(!r.has(e)){let o=t;for(;o;){const a=Object.values(Object.getOwnPropertyDescriptors(o));for(let c of a)if(c.value===e)return r.set(e,!0),e.call(t,...i);o=Object.getPrototypeOf(o)}r.set(e,!1)}return r.get(e)?e.call(t,...i):e(...i)}};w.methodMap=new WeakMap;let b=w;function C(n,e="param"){if(!n)throw new Error("onChange: fnKey is undefined, make sure the function exists or provide a string");return(t,i,r)=>{const o={get(){return this[`_oc_${i}`]},set(a){var f;const c=this[`_oc_${i}`];if(c===a)return;this[`_oc_${i}`]=a;const l=e==="param"?[i,a,c,this]:e==="object"?[{key:i,value:a,oldValue:c,target:this}]:[];typeof n=="string"?(f=this[n])==null||f.call(this,...l):typeof n=="function"&&b.callFunction(n,this,l)}};if(r)return v(r,"value")&&delete r.value,v(r,"writable")&&delete r.writable,v(r,"initializer")&&delete r.initializer,Object.assign(r,o);Object.defineProperty(t,i,o)}}function _e(n,e="void"){if(!n)throw new Error("onChange: fnKey is undefined, make sure the function exists or provide a string");return C(n,e)}function Te(n,e="object"){if(!n)throw new Error("onChange: fnKey is undefined, make sure the function exists or provide a string");return C(n,e)}function Ue(n){return C((e,t,i,r)=>{if(!r.dispatchEvent)throw new Error("onChangeDispatchEvent: target does not have dispatchEvent");r.dispatchEvent({type:n||`${e}-changed`,detail:{key:e,value:t,oldValue:i}})},"param")}function Le(n){return(e,t)=>{const i=e.constructor;if(i===Object)throw new Error("All properties in an object are serialized by default");m.TypeMap.has(i)||m.TypeMap.set(i,[]),m.TypeMap.get(i).push([n||t,t])}}function Ae(n){return e=>(e=class extends e{constructor(){super(...arguments),this.serializableClassId=n}},m.SerializableClasses.set(n,e),e)}async function ze(n,e,t){const i=typeof e=="string"?new TextEncoder().encode(e):e,r=await crypto.subtle.digest("SHA-256",i),o=crypto.getRandomValues(new Uint8Array(12)),a=Array.from(o).map(z=>String.fromCharCode(z)).join(""),c={name:"AES-GCM",iv:o},l=await crypto.subtle.importKey("raw",r,c,!1,["encrypt"]),f=typeof n=="string"?new TextEncoder().encode(n):n,d=await crypto.subtle.encrypt(c,l,f),A=new Uint8Array(d),Y=Array.from(A),ot=Y.map(z=>String.fromCharCode(z)).join(""),at=t?typeof t=="string"?t:new TextDecoder().decode(t):"",ct=t?typeof t=="string"?new TextEncoder().encode(t):Array.from(t):[];return typeof n=="string"?at+a+ot:new Uint8Array([...ct,...o,...Y])}async function De(n,e){const t=typeof e=="string"?new TextEncoder().encode(e):e,i=await crypto.subtle.digest("SHA-256",t),r=n.slice(0,12),a={name:"AES-GCM",iv:typeof r=="string"?new Uint8Array(Array.from(r).map(d=>d.charCodeAt(0))):r},c=await crypto.subtle.importKey("raw",i,a,!1,["decrypt"]),l=n.slice(12),f=typeof l=="string"?new Uint8Array(Array.from(l).map(d=>d.charCodeAt(0))):l;try{const d=await crypto.subtle.decrypt(a,c,f);return typeof n=="string"?new TextDecoder().decode(d):new Uint8Array(d)}catch{throw new Error("Decrypt failed")}}async function Oe(){return"showOpenFilePicker"in window?window.showOpenFilePicker().then(n=>n[0]):window.chooseFileSystemEntries()}function Pe(){if("showSaveFilePicker"in window){const e={types:[{description:"Text file",accept:{"text/plain":[".txt"]}}]};return window.showSaveFilePicker(e)}const n={type:"save-file",accepts:[{description:"Text file",extensions:["txt"],mimeTypes:["text/plain"]}]};return window.chooseFileSystemEntries(n)}function Ie(n){return n.text?n.text():Me(n)}function Me(n){return new Promise(e=>{const t=new FileReader;t.addEventListener("loadend",i=>{const r=(i.srcElement||i.target).result;e(r)}),t.readAsText(n)})}async function Re(n,e){if(n.createWriter){const i=await n.createWriter();await i.write(0,e),await i.close();return}const t=await n.createWritable();await t.write(e),await t.close()}async function Fe(n,e){const t={};return e&&(t.writable=!0,t.mode="readwrite"),await n.queryPermission(t)==="granted"||await n.requestPermission(t)==="granted"}function T(n,e=8192,t=!1){var a;if(!n.width||!n.height)throw new Error("Invalid bitmap");const i=document.createElement("canvas");i.width=Math.min(e,n.width),i.height=Math.floor(1+i.width*n.height/n.width);const r=n instanceof ImageBitmap,o=r&&t&&Math.abs(i.width-n.width)<.5?i.getContext("bitmaprenderer"):void 0;return o?o.transferFromImageBitmap(n):(a=i.getContext("2d"))==null||a.drawImage(n,0,0,i.width,i.height),r&&t&&n.close(),i}function Be(n,e=8192,t=!1,i="image/png"){if(!n.width||!n.height)return"";const r=T(n,e,!1),o=r.toDataURL(i);return r.remove(),t&&n instanceof ImageBitmap&&n.close(),o}async function $e(n,e=8192,t=!1,i="image/png"){if(!n.width||!n.height)return Promise.reject("Invalid bitmap");const r=T(n,e,!1);return new Promise((o,a)=>{r.toBlob(c=>{c?o(c):a("Could not get blob"),r.remove(),t&&n instanceof ImageBitmap&&n.close()},i)})}async function Ne(n){return new Promise((e,t)=>{const i=new Image;i.addEventListener("load",()=>{const r=document.createElement("canvas");r.width=i.width,r.height=i.height;const o=r.getContext("2d");if(!o){t(new Error("Could not get 2d context"));return}o.drawImage(i,0,0,r.width,r.height);const a=o.getImageData(0,0,r.width,r.height);e(a),r.remove(),i.remove()},!1),i.addEventListener("error",r=>{i.remove(),t(r)},!1),i.src=n})}function W(n,{backgroundColor:e="",scale:t=1,width:i=512,height:r=512}){const o=document.createElement("canvas"),a=o.getContext("2d"),c=t,l=i,f=r;return o.width=l*c,o.height=f*c,o.style.width=`${l}`,o.style.height=`${f}`,(e==null?void 0:e.length)>0&&(a.fillStyle=e,a.fillRect(0,0,o.width,o.height)),a.drawImage(n,0,0,o.width,o.height),o}function xe(n){const e=document.createElement("canvas");return e.width=n.width,e.height=n.height,e.getContext("2d").putImageData(n,0,0),e}function He(){const n=document.createElement("canvas");return n.getContext&&n.getContext("2d")?n.toDataURL("image/webp").startsWith("data:image/webp"):!1}function We(n){const e=document.createElement("canvas");e.width=n.width,e.height=n.height;const t=e.getContext("2d");if(!t)throw new Error("Unable to get 2d context");return t.translate(0,n.height),t.scale(1,-1),t.drawImage(n,0,0),e}function qe(n){return new Promise((e,t)=>{const i=new Image,r=URL.createObjectURL(n);i.onload=()=>{URL.revokeObjectURL(r),e(i)},i.onerror=o=>{URL.revokeObjectURL(r),t(o)},i.src=r})}const Ye=n=>`data:image/svg+xml,%3Csvg width='16' height='16' viewBox='0 0 16 16' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Crect width='16' height='16' fill='%23${n}'/%3E%3C/svg%3E%0A`,Ke=n=>`data:image/svg+xml,%3Csvg width='16' height='16' viewBox='0 0 16 16' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Ccircle cx='8' cy='8' r='7' fill='%23${n}'/%3E%3C/svg%3E%0A`,Ve=n=>`data:image/svg+xml,%3Csvg viewBox='0 0 80 14' xmlns='http://www.w3.org/2000/svg'%3E%3Ctext style='font: 8px "Roboto Mono", "Source Code Pro", Menlo, Courier, monospace; fill: white;' x='9' y='9'%3E${n}%3C/text%3E%3C/svg%3E%0A`,U=async(n,e)=>{const t=await D(n);return W(t,e)},q=async(n,e)=>await U(n,e).then(t=>t.toDataURL("image/png")),Je=async n=>$(await(await fetch(n)).blob());async function Ge(n,e=Je){const t=n.match(/(((ftp|https?):\/\/)[\-\w@:%_\+.~#?,&\/\/=]+)/g);if(t)for(const i of t){const r=await e(i);n=n.replace(i,r)}return n}function L(n,e,{width:t,height:i},r=!0){const o=`
<svg viewBox="0 0 ${t} ${i}" xmlns="http://www.w3.org/2000/svg">
    <style>
    ${e}
    </style>
    <foreignObject x="0" y="0" width="100%" height="100%">
        <div xmlns="http://www.w3.org/1999/xhtml" style="height: 100%; width: 100%; position: absolute: top:0; left:0">
            ${n}
        </div>
    </foreignObject>
</svg>
    `;return r?F(o):o}async function Xe(n,e,t){const i=L(n,e,t);return await U(i,t)}async function Qe(n,e,t){const i=L(n,e,t);return await q(i,t)}function Ze(n,e){return Math.abs(n)>Math.abs(e)?n:e}function je(n,e,t){const i=t?1:0,r=~(1<<e);return n&r|i<<e}function et(n,e){const t=~(1<<e);return n&t}function tt(){const n=(i,r)=>i.toString(16).padStart(r,"0"),e=crypto.getRandomValues(new Uint8Array(16));e[6]=e[6]&15|64,e[8]=e[8]&63|128;const t=new DataView(e.buffer);return`${n(t.getUint32(0),8)}-${n(t.getUint16(4),4)}-${n(t.getUint16(6),4)}-${n(t.getUint16(8),4)}-${n(t.getUint32(10),8)}${n(t.getUint16(14),4)}`}function nt(n,e=null){return new URL(window.location.href).searchParams.get(n)??e}function it(n,e,t=!1){const i=new URLSearchParams(location.search);e==null?i.has(n)&&i.delete(n):i.set(n,e),t?window.location.search=i.toString():window.history.replaceState({},"","?"+i.toString())}function rt(n,e="/"){return n.join(e)}function st(n,e){const t=(e?`var Module = { locateFile: function(s) { return "${e}"; } }; 
`:"")+`importScripts( "${n}" );`;return URL.createObjectURL(new Blob([t],{type:"text/javascript"}))}s.Damper=E,s.FnCaller=b,s.JSUndoManager=J,s.LinearToSRGB=ge,s.PointerDragHelper=V,s.SRGBToLinear=me,s.Serialization=m,s.SimpleEventDispatcher=p,s.TYPED_ARRAYS=I,s.absMax=Ze,s.aesGcmDecrypt=De,s.aesGcmEncrypt=ze,s.arrayBufferToBase64=j,s.base64ToArrayBuffer=ee,s.blobToDataURL=$,s.blobToImage=qe,s.canvasFlipY=We,s.clearBit=et,s.cloneScriptTag=P,s.colorToDataUrl=pe,s.copyProps=ye,s.createCanvasElement=G,s.createDiv=X,s.createImage=D,s.createScriptFromURL=Q,s.createStyles=O,s.css=R,s.deepAccessObject=Ee,s.downloadBlob=B,s.downloadFile=he,s.embedUrlRefs=Ge,s.escapeRegExp=M,s.findLastIndex=H,s.getFileHandle=Oe,s.getFilenameFromPath=se,s.getKeyByValue=Se,s.getNewFileHandle=Pe,s.getOrCall=we,s.getPropertyDescriptor=N,s.getTypedArray=te,s.getUrlQueryParam=nt,s.glsl=ce,s.html=le,s.htmlToCanvas=Xe,s.htmlToPng=Qe,s.htmlToSvg=L,s.imageBitmapToBase64=Be,s.imageBitmapToBlob=$e,s.imageBitmapToCanvas=T,s.imageDataToCanvas=xe,s.imageToCanvas=W,s.imageUrlToImageData=Ne,s.includesAll=ve,s.isPropertyWritable=x,s.isWebpExportSupported=He,s.longestCommonPrefix=ae,s.makeColorSvg=Ye,s.makeColorSvgCircle=Ke,s.makeTextSvg=Ve,s.mobileAndTabletCheck=de,s.now=y,s.objectHasOwn=v,s.objectMap=ke,s.objectMap2=k,s.onChange=C,s.onChange2=_e,s.onChange3=Te,s.onChangeDispatchEvent=Ue,s.parseFileExtension=re,s.pathJoin=rt,s.prettyScrollbar=ue,s.readFile=Ie,s.remoteWorkerURL=st,s.replaceAll=h,s.safeReplaceString=oe,s.safeSetProperty=S,s.serializable=Ae,s.serialize=Le,s.setInnerHTMLWithScripts=Z,s.setUrlQueryParam=it,s.svgToCanvas=U,s.svgToPng=q,s.svgUrl=F,s.timeout=K,s.toCamelCase=ie,s.toTitleCase=ne,s.updateBit=je,s.uploadFile=fe,s.uuidV4=tt,s.verifyPermission=Fe,s.wrapThisFunction=be,s.wrapThisFunction2=Ce,s.writeFile=Re,Object.defineProperty(s,Symbol.toStringTag,{value:"Module"})});
//# sourceMappingURL=bundle.umd.js.map
