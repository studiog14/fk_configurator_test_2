{"version":3,"file":"bundle.esm.js","sources":["../src/EventDispatcher.ts","../src/time.ts","../src/PointerDragHelper.ts","../src/JSUndoManager.ts","../src/damper.ts","../src/dom.ts","../src/arrayBuffer.ts","../src/text.ts","../src/template-literals.ts","../src/styles.ts","../src/browser.ts","../src/color.ts","../src/obj-property.ts","../src/misc.ts","../src/object.ts","../src/serialization.ts","../src/fnCaller.ts","../src/decorators.ts","../src/encryption.ts","../src/fs-api.ts","../src/image.ts","../src/svg.ts","../src/htmlToImage.ts","../src/math.ts","../src/url.ts"],"sourcesContent":["/**\n * A simple event interface with typed event types.\n */\nexport interface IEvent<T> {\n    type: T;\n    target?: any;\n    [attachment: string]: any;\n}\n\n/**\n * A simple event dispatcher interface with {@link IEvent} as event type.\n */\nexport interface IEventDispatcher<T> {\n\n    /**\n     * Adds a listener to an event type.\n     * @param type The type of event to listen to.\n     * @param listener The function that gets called when the event is fired.\n     */\n    addEventListener(type: T, listener: (event: IEvent<T>) => void): void;\n\n    /**\n     * Checks if listener is added to an event type.\n     * @param type The type of event to listen to.\n     * @param listener The function that gets called when the event is fired.\n     */\n    hasEventListener(type: T, listener: (event: IEvent<T>) => void): boolean;\n\n    /**\n     * Removes a listener from an event type.\n     * @param type The type of the listener that gets removed.\n     * @param listener The listener function that gets removed.\n     */\n    removeEventListener(type: T, listener: (event: IEvent<T>) => void): void;\n\n    /**\n     * Fire an event type.\n     * @param event.type The type of event that gets fired.\n     */\n    dispatchEvent(event: IEvent<T>): void;\n}\n\n/**\n * A simple event dispatcher with typed event types, see {@link IEventDispatcher}.\n */\nexport class SimpleEventDispatcher<T extends string> implements IEventDispatcher<T> {\n\n    constructor() {\n        this.dispatchEvent = this.dispatchEvent.bind(this)\n        this.addEventListener = this.addEventListener.bind(this)\n        this.removeEventListener = this.removeEventListener.bind(this)\n        this.hasEventListener = this.hasEventListener.bind(this)\n    }\n\n    private _eventListeners: Record<string, ((event: IEvent<T>) => void)[]> = {}\n\n    addEventListener(type: T, listener: (event: IEvent<T>) => void): void {\n\n        const listeners = this._eventListeners\n        if (listeners[ type ] === undefined) listeners[type] = []\n        if (!listeners[ type ].includes(listener)) listeners[type].push(listener)\n\n    }\n\n    hasEventListener(type: T, listener: (event: IEvent<T>) => void): boolean {\n\n        const listeners = this._eventListeners\n        return listeners[ type ] !== undefined && listeners[ type ].includes(listener)\n\n    }\n\n    removeEventListener(type: T, listener: (event: IEvent<T>) => void): void {\n\n        const listeners = this._eventListeners\n        const listenerArray = listeners[ type ]\n        if (listenerArray !== undefined) {\n            const index = listenerArray.indexOf(listener)\n            if (index !== -1) listenerArray.splice(index, 1)\n        }\n\n    }\n\n    dispatchEvent(event: IEvent<T>): void {\n\n        const listeners = this._eventListeners\n        const listenerArray = listeners[ event.type ]\n\n        if (listenerArray !== undefined) {\n            event.target = this\n            // Make a copy, in case listeners are removed while iterating.\n            const array = listenerArray.slice(0)\n            for (let i = 0, l = array.length; i < l; i++) array[i].call(this, event)\n\n        }\n\n    }\n\n}\n","/**\n * Returns a promise that resolves after the given duration. Basically a setTimeout that returns a promise.\n * @param duration - in ms\n *\n * @category Time\n */\nexport async function timeout(duration: number) {\n    return new Promise(resolve => setTimeout(resolve, Math.max(0, duration)))\n}\n\n/**\n * Returns the current time in milliseconds. If performance.now() is available, it is used, otherwise Date.now() is used.\n *\n * @category Time\n */\nexport function now(): number { // in milliseconds\n    return (typeof performance === 'undefined' ? Date : performance).now() // see threejs  #10732\n}\n","import {SimpleEventDispatcher} from \"./EventDispatcher\";\nimport {now} from \"./time\";\nimport {IDisposable} from \"./types\";\n\n/**\n * A helper class to handle pointer events and dispatch drag events: `drag`, `dragStart` and `dragEnd` with NDC coordinates and time.\n *\n * To use, create an object of the class, set `element` with the HTML element(like canvas) and add event listeners to drag events.\n *\n * @example\n * ```ts\n * const pointerDragHelper = new PointerDragHelper()\n * pointerDragHelper.element = canvas\n * pointerDragHelper.addEventListener('dragStart', (e) => {\n *    console.log('dragStart', e.pointer)\n *    // {x: -0.5, y: 0.5, time: 123456789}\n *    // x and y are NDC coordinates, time is the time when the event is fired.\n *    // x and y are in the range of [-1, 1].\n *    // x is left to right, y is bottom to top.\n *    // time is in milliseconds.\n * })\n * pointerDragHelper.addEventListener('drag', (e) => {\n *   console.log('drag', e.pointer)\n *   // {x: -0.5, y: 0.5, time: 123456789}\n * })\n * pointerDragHelper.addEventListener('dragEnd', (e) => {\n *  console.log('dragEnd', e.pointer)\n *  // {x: -0.5, y: 0.5, time: 123456789}\n * })\n * ```\n */\nexport class PointerDragHelper extends SimpleEventDispatcher<'dragStart' | 'drag' | 'dragEnd'> implements IDisposable{\n    private _pointerDown?: {x: number, y: number, time: number}\n    private _pointer?: {x: number, y: number, time: number}\n    private _pointerUp?: {x: number, y: number, time: number}\n\n    get element(): HTMLElement | undefined {\n        return this._element\n    }\n\n    set element(value: HTMLElement | undefined) {\n        if (this._element === value) return\n        if (this._element) this._removeElement()\n        this._element = value\n        if (this._element) this._addElement()\n    }\n\n    private _element?: HTMLElement\n\n    private _removeElement() {\n        this._element?.removeEventListener('pointerdown', this._onPointerDown)\n        this._element?.removeEventListener('pointermove', this._onPointerMove)\n        this._element?.removeEventListener('pointerup', this._onPointerUp)\n        this._element?.removeEventListener('pointercancel', this._onPointerUp)\n        this._element?.removeEventListener('pointerout', this._onPointerUp)\n    }\n\n    private _addElement() {\n        this._element?.addEventListener('pointerdown', this._onPointerDown)\n        this._element?.addEventListener('pointermove', this._onPointerMove)\n        this._element?.addEventListener('pointerup', this._onPointerUp)\n        this._element?.addEventListener('pointercancel', this._onPointerUp)\n        this._element?.addEventListener('pointerout', this._onPointerUp)\n    }\n\n    private _onPointerDown = (e: PointerEvent) => {\n        if (e.button !== 0) return\n        if (!this._element) return\n        this._pointerUp = undefined\n        const x = e.clientX / this._element!.clientWidth * 2 - 1\n        const y = -(e.clientY / this._element!.clientHeight) * 2 + 1\n        const time = now()\n        this._pointerDown = {x, y, time}\n        this._pointer = this._pointerDown\n        this.dispatchEvent({type: 'dragStart', pointer: this._pointerDown})\n    }\n    private _onPointerMove = (e: PointerEvent) => {\n        if (!this._pointerDown || !this._pointer) return\n        if (!this._element) return\n        const x = e.clientX / this._element!.clientWidth * 2 - 1\n        const y = -(e.clientY / this._element!.clientHeight) * 2 + 1\n        const time = now()\n        this.dispatchEvent({\n            type: 'drag', pointer: this._pointer,\n            drag: {x: x - this._pointerDown.x, y: y - this._pointerDown.y, time: time - this._pointerDown.time},\n            delta: {x: x - this._pointer.x, y: y - this._pointer.y, time: time - this._pointer.time},\n        })\n        this._pointer = {x: x, y: y, time: now()}\n\n        if (e.buttons % 2 === 0) this._onPointerUp(e)\n    }\n    private _onPointerUp = (e: PointerEvent) => {\n        if (e.button !== 0) return\n        if (!this._pointerDown) return\n        if (!this._element) return\n        const x = e.clientX / this._element!.clientWidth * 2 - 1\n        const y = -(e.clientY / this._element!.clientHeight) * 2 + 1\n        const time = now()\n        this._pointerUp = {x: x, y: y, time}\n        this.dispatchEvent({\n            type: 'dragEnd', pointer: this._pointerUp,\n            drag: {\n                x: this._pointerUp.x - this._pointerDown.x,\n                y: this._pointerUp.y - this._pointerDown.y,\n                time: this._pointerUp.time - this._pointerDown.time,\n            },\n        })\n        this._pointerDown = undefined\n        this._pointer = undefined\n    }\n\n    dispose() {\n        this.element = undefined\n    }\n}\n","/*!\n * Fork Of -\n * JavaScript Undo Manager 1.0.0\n * Simple JavaScript undo/redo command manager supporting transactions with no dependencies.\n *\n * Copyright: Alexey Grinko, 2017\n * Git repository: https://github.com/agrinko/js-undo-manager.git\n *\n * @license MIT - https://opensource.org/licenses/MIT\n *\n * Changes -\n * 1. Added presets commands\n * 2. Port to TypeScript\n * 3. Remove transactions\n */\n\n/////////// SOURCE CODE ///////////////\n\nexport interface JSUndoManagerOptions{\n    limit: number;\n    debug: boolean;\n    bindHotKeys: boolean;\n    hotKeyRoot?: HTMLElement;\n    // useTransactions: boolean;\n}\nexport type JSUndoManagerCommand1 = {\n    redo: Function;\n    undo: Function;\n}\nexport type JSUndoManagerCommand2 = {\n    type: string,\n    // [key: string]: any\n}\nexport type JSUndoManagerCommand = JSUndoManagerCommand1 | JSUndoManagerCommand2\n\n/**\n * Main class\n * @class JSUndoManager\n */\nexport class JSUndoManager {\n    limit: number;\n    options: JSUndoManagerOptions = {\n        limit: 500,             // maximum commands stack size\n        debug: false,           // whether to emit execution status in console\n        bindHotKeys: false,     // whether to bind \"undo\" and \"redo\" commands to \"Ctrl+Z\", \"Ctrl+Y\" & \"Ctrl+Shift+Z\" hot keys\n        // useTransactions: true   // whether to initialize transactions manager\n    }\n    enabled = true;\n    stack: JSUndoManagerCommand[];\n    sp: number;\n    // transaction: TransactionManager;\n    presets: Record<string, (c: JSUndoManagerCommand2)=>JSUndoManagerCommand1> = {}\n\n    constructor(options: JSUndoManagerOptions) {\n        Object.assign(this.options, options);\n\n        this.limit = options.limit;\n        this.options = options;\n        this.reset();\n\n        // if (options.useTransactions) {\n        //     this.transaction = new TransactionManager(this);\n        // }\n        if (options.bindHotKeys) {\n            this.bindHotKeys();\n        }\n\n        this.log(`Initialized with stack limit of ${this.limit} commands`);\n    }\n\n    /**\n     * Bind 'undo' and 'redo' actions to 'Ctrl/Cmd+Z', 'Ctrl+Y' & 'Ctrl/Cmd+Shift+Z' hot keys.\n     * It is a basic implementation for quick testing and should be replaced with custom event handlers\n     * for more flexible processing.\n     * @returns {JSUndoManager}\n     */\n    bindHotKeys() {\n        this.log(\"Bound 'undo' and 'redo' actions to 'Ctrl/Cmd+Z', 'Ctrl+Y' & 'Ctrl/Cmd+Shift+Z' hot keys\");\n\n        const elem = this.options.hotKeyRoot??document\n        elem.addEventListener(\"keydown\", this._keyDown);\n\n        return this;\n    }\n\n    dispose() {\n        const elem = this.options.hotKeyRoot??document\n        elem.removeEventListener(\"keydown\", this._keyDown);\n        return this.reset()\n    }\n\n    private _keyDown = (e: KeyboardEvent) => {\n        if(!this.enabled) return\n        const ctrlKey = e.ctrlKey || e.metaKey;\n        if (e.code === 'KeyZ' && ctrlKey && !e.shiftKey) {\n            this.undo();\n        } else if ((e.code === 'KeyZ' && ctrlKey && e.shiftKey) || (e.code === 'KeyY' && e.ctrlKey)) {\n            this.redo();\n        }\n    }\n\n    /**\n     * Remember executed command containing \"redo\" and \"undo\" functions\n     * @param {Object|Function} command - either an object with \"redo\" and \"undo\" functions\n     * @returns {JSUndoManager}\n     */\n    record(command: JSUndoManagerCommand): this {\n        if(!this.enabled) return this\n        this._record(command);\n        return this;\n    }\n\n    replaceLast(command: JSUndoManagerCommand) {\n        const last = this.peek()\n        if(!last) return\n\n        this.log('replace', last, 'with', command)\n\n        this.stack[this.sp] = command\n\n        return this\n    }\n\n    /**\n     * Execute function and record it with its opposite \"undo\" function\n     * @param {Object|Function} command - either an object with \"redo\" and \"undo\" functions\n     * @param {Function} [undo] - \"undo\" function, used if the first argument is also a function\n     * @returns {JSUndoManager}\n     */\n    execute(command: JSUndoManagerCommand) {\n        if(!this.enabled) return\n\n        let command1 = this._rc(command);\n        let doFunction = command1.redo;\n\n        this.record.apply(this, command1);\n\n        this.log(\"Executing function...\");\n        doFunction.apply(command);\n\n        return this;\n    }\n\n    _rc(command: JSUndoManagerCommand1 | JSUndoManagerCommand2) {\n        if ((command as JSUndoManagerCommand2).type) {\n            const p = this.presets[(command as JSUndoManagerCommand2).type]\n            if (typeof p === 'function') {\n                return p((command as JSUndoManagerCommand2))\n            } else {\n                console.error(command, p, this.presets)\n                throw new Error(`Preset command not found`)\n            }\n        } else\n            return command as JSUndoManagerCommand1\n    }\n\n    _record(command: JSUndoManagerCommand) {\n        if(!this.enabled) return\n        // if (this.transaction.isInProgress())\n        //     return this.transaction._record(command);\n\n        this.log(\"Recording command\", command);\n\n        this._rebase();\n\n        this.stack.push(command);\n        this.sp++;\n\n        this._keepLimit();\n    }\n\n    //forget \"future\" commands if stack pointer is not at the end\n    _rebase() {\n        if (this.canRedo())\n            this.stack.length = this.sp + 1;\n    }\n\n    //sustain limited size of stack; cut extra commands starting with the latest ones\n    _keepLimit() {\n        if (this.stack.length <= this.limit)\n            return;\n\n        let exceedsBy = this.stack.length - this.limit;\n\n        this.log(\"Stack size reached its limit: ${this.limit} commands. Cutting off most old commands...\");\n\n        if (exceedsBy === 1)\n            this.stack.shift(); //this is the most common case, so using \"shift\" will increase performance a bit\n        else\n            this.stack.splice(0, exceedsBy);\n\n        this.sp -= exceedsBy; //normalize stack pointer for the new stack length\n    }\n\n    /**\n     * Undo previous command if possible\n     * @returns {JSUndoManager}\n     */\n    undo() {\n        if (!this.canUndo())\n            return this;\n\n        let command = this.stack[this.sp];\n\n        this.log(\"undo\");\n\n        this.sp--;\n\n        this._rc(command).undo();\n\n        return this;\n    }\n\n    /**\n     * Check whether undoing previous command is possible\n     * @returns {boolean}\n     */\n    canUndo() {\n        return this.sp >= 0 && this.enabled;\n    }\n\n    /**\n     * Get the last command that was done\n     */\n    peek() {\n        return this.canUndo() ? this.stack[this.sp] : null\n    }\n\n    /**\n     * Redo the command which was previously undone\n     * @returns {JSUndoManager}\n     */\n    redo() {\n        if (!this.canRedo())\n            return this;\n\n        let command = this.stack[this.sp + 1]; //execute next command after stack pointer\n\n        this.log(\"redo\");\n\n        this.sp++;\n\n        this._rc(command).redo();\n\n        return this;\n    }\n\n    /**\n     * Check whether redoing command is possible\n     * @returns {boolean}\n     */\n    canRedo() {\n        return this.sp < this.stack.length - 1 && this.enabled; //if stack pointer is not at the end\n    }\n\n    /**\n     * Gets the last command that was undone\n     */\n    peekForward() {\n        return this.canRedo() ? this.stack[this.sp + 1] : null\n    }\n\n    /**\n     * Change stack size limit initially defined in the constructor options\n     * @param {number} limit\n     */\n    setLimit(limit: number) {\n        let redoable = this.stack.length - this.sp - 1;\n\n        if (limit < 1 || !(typeof limit === \"number\"))\n            throw new TypeError(`JSUndoManager.setLimit(): unexpected argument limit=${limit}. Should be a positive number`);\n\n        if (limit < redoable) {\n            console.warn(`JSUndoManager.setLimit(): cannot set stack limit (${limit}) less than the number of 'redoable' commands (${redoable})`);\n        } else {\n            this.limit = Math.floor(limit);\n            this._keepLimit();\n        }\n\n        return this;\n    }\n\n    /**\n     * Reset all commands from memory\n     */\n    reset() {\n        this.log(\"reset\");\n        this.stack = [];\n        this.sp = -1;\n        return this;\n    }\n\n    /**\n     * Check whether the commands stack is empty\n     * @returns {boolean}\n     */\n    isEmpty() {\n        return !this.stack.length;\n    }\n\n    /**\n     * Check whether the commands stack size reaches its limit\n     * @returns {boolean}\n     */\n    isFull() {\n        return this.stack.length === this.limit;\n    }\n\n    /**\n     * Get number of commands in memory stack\n     * @returns {Number}\n     */\n    getSize() {\n        return this.stack.length;\n    }\n\n    log(msg: string, ...args: any[]) {\n        if (this.options.debug)\n            console.log(`Command Manager: ${msg}`, ...args);\n    }\n}\n\n// /**\n//  * Transaction manager helper.\n//  * Allows working with transactions from JSUndoManager. Requires its instance as a constructor's parameter.\n//  * @class TransactionManager\n//  */\n// class TransactionManager {\n//     static _execForward(sequence) {\n//         for (let i = 0; i < sequence.length; i++)\n//             sequence[i].redo();\n//     }\n//\n//     static _execBack(sequence) {\n//         for (let i = sequence.length - 1; i >= 0; i--)\n//             sequence[i].undo();\n//     }\n//\n//     constructor(tracker) {\n//         this.tracker = tracker;\n//         this._reset();\n//\n//         tracker.log(\"TransactionManager is initialized\");\n//     }\n//\n//     begin() {\n//         this.state = TransactionManager.IN_PROGRESS;\n//         this.tracker.log(\"Begin transaction\");\n//     }\n//\n//     end() {\n//         let seq = this.sequence;\n//\n//         this._reset();\n//\n//         if (seq.length > 0) {\n//             this.tracker.record({\n//                 redo: TransactionManager._execForward.bind(null, seq),\n//                 undo: TransactionManager._execBack.bind(null, seq)\n//             });\n//         }\n//\n//         this.tracker.log(\"End transaction\");\n//     }\n//\n//     cancel() {\n//         TransactionManager._execBack(this.sequence);\n//         this._reset();\n//\n//         this.tracker.log(\"Cancel transaction\");\n//     }\n//\n//     isInProgress() {\n//         return this.state === TransactionManager.IN_PROGRESS;\n//     }\n//\n//     isPending() {\n//         return this.state === TransactionManager.PENDING;\n//     }\n//\n//     _record(command) {\n//         this.sequence.push(command);\n//         this.tracker.log(\"Recording command in transaction...\", command);\n//     }\n//\n//     _reset() {\n//         this.state = TransactionManager.PENDING;\n//         this.sequence = [];\n//     }\n// }\n//\n// TransactionManager.PENDING = 0;\n// TransactionManager.IN_PROGRESS = 1;\n//\n// /////////// SOURCE CODE END ///////////////\n//\n// // HELPER FUNCTIONS\n// /**\n//  * Emulate ES6 Object.assign behaviour if native function is not defined\n//  */\n// let assign = Object.assign || function (target) {\n//     for (let i = 1; i < arguments.length; i++) {\n//         for (let key in arguments[i]) {\n//             if (arguments[i].hasOwnProperty(key)) {\n//                 target[key] = arguments[i][key];\n//             }\n//         }\n//     }\n//\n//     return target;\n// };\n","/* @license\n * Copyright 2020 Google LLC. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the 'License');\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an 'AS IS' BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n/**\n * The Damper class is a generic second-order critically damped system that does\n * one linear step of the desired length of time. The only parameter is\n * DECAY_MILLISECONDS. This common parameter makes all states converge at the\n * same rate regardless of scale. xNormalization is a number to provide the\n * rough scale of x, such that NIL_SPEED clamping also happens at roughly the\n * same convergence for all states.\n *\n * Taken from Google model-viewer.\n *\n * https://github.com/google/model-viewer/blob/ec527bc1d0e1bcb4421fa192a7e62bbc5764db91/packages/model-viewer/src/three-components/Damper.ts#L1\n */\nexport class Damper {\n    static readonly SETTLING_TIME = 10000;  // plenty long enough\n    static readonly MIN_DECAY_MILLISECONDS = 0.001;\n    static readonly DECAY_MILLISECONDS = 50;\n\n    private velocity: number = 0;\n    private naturalFrequency: number = 0;\n\n    constructor(decayMilliseconds: number = Damper.DECAY_MILLISECONDS) {\n        this.setDecayTime(decayMilliseconds);\n    }\n\n    setDecayTime(decayMilliseconds: number) {\n        this.naturalFrequency =\n            1 / Math.max(Damper.MIN_DECAY_MILLISECONDS, decayMilliseconds);\n    }\n\n    update(\n        v: number,\n        vGoal: number,\n        timeStepMilliseconds: number,\n        xNormalization: number,\n    ): number {\n        const nilSpeed = 0.0002 * this.naturalFrequency;\n\n        if (v == null || xNormalization === 0) {\n            return vGoal;\n        }\n        if (v === vGoal && this.velocity === 0) {\n            return vGoal;\n        }\n        if (timeStepMilliseconds < 0) {\n            return v;\n        }\n        // Exact solution to a critically damped second-order system, where:\n        // acceleration = this.naturalFrequency * this.naturalFrequency * (vGoal\n        // - v) - 2 * this.naturalFrequency * this.velocity;\n        const deltaV = (v - vGoal);\n        const intermediateVelocity = this.velocity + this.naturalFrequency * deltaV;\n        const intermediateX = deltaV + timeStepMilliseconds * intermediateVelocity;\n        const decay = Math.exp(-this.naturalFrequency * timeStepMilliseconds);\n        const newVelocity =\n            (intermediateVelocity - this.naturalFrequency * intermediateX) * decay;\n        const acceleration =\n            -this.naturalFrequency * (newVelocity + intermediateVelocity * decay);\n        if (Math.abs(newVelocity) < nilSpeed * Math.abs(xNormalization) &&\n            acceleration * deltaV >= 0) {\n            // This ensures the controls settle and stop calling this function instead\n            // of asymptotically approaching their goal.\n            this.velocity = 0;\n            return vGoal;\n        } else {\n            this.velocity = newVelocity;\n            return vGoal + intermediateX * decay;\n        }\n    }\n}\n","/**\n * Creates a HTML canvas element.\n * @category DOM\n */\nexport function createCanvasElement(): HTMLCanvasElement {\n    const canvas = document.createElementNS('http://www.w3.org/1999/xhtml', 'canvas') as HTMLCanvasElement\n    canvas.style.display = 'block'\n    return canvas\n}\n\n/**\n * Creates an HTML div element.\n * @param innerHTML - HTML string to add to the div\n * @param id - id of the div\n * @param classList - list of classes to add to the div\n * @param addToBody - add the div to the body\n * @param elementTag - tag of the element to create (default: div)\n *\n * @category DOM\n */\nexport function createDiv<T extends keyof HTMLElementTagNameMap = 'div'>({innerHTML = '', id, classList, addToBody = true, elementTag = <T>'div'}: {innerHTML?: string, id?: string, classList?: string[], addToBody?:boolean, elementTag?: T}): HTMLElementTagNameMap[T] {\n    const elem = document.createElement(elementTag)\n    if (id) elem.id = id\n    elem.innerHTML = innerHTML\n    if (classList) elem.classList.add(...classList)\n    if (addToBody) document.body.appendChild(elem)\n    return elem\n}\n\n/**\n * Creates a HTML image element from a url.\n * @param url - url of the image\n *\n * @category DOM\n */\nexport async function createImage(url: string): Promise<HTMLImageElement> {\n    return new Promise((resolve, reject) => {\n        const img = new Image()\n        img.onload = () => resolve(img)\n        img.onerror = reject\n        img.crossOrigin = 'anonymous'\n        img.decoding = 'sync'\n        img.src = url\n    })\n}\n\n/**\n * Creates a HTML style element with the given styles.\n * @param styles - CSS string\n * @param root - root element to add the style to (default: head)\n *\n * @category DOM\n */\nexport function createStyles(styles: string, root: Element|undefined = document.head) {\n    const styleSheet = document.createElement('style')\n    styleSheet.type = 'text/css'\n    styleSheet.innerText = styles\n    root?.appendChild(styleSheet)\n    return styleSheet\n}\n\n/**\n * Creates a HTML script element from a url.\n * @param url - url of the script\n * @param root - root element to add the script to (default: head)\n *\n * @category DOM\n */\nexport async function createScriptFromURL(url: string, root = document.head): Promise<HTMLScriptElement> {\n    return new Promise<HTMLScriptElement>((resolve, reject) => {\n        const s = document.createElement('script')\n\n        s.setAttribute('src', url)\n        s.addEventListener('load', ()=>resolve(s))\n        s.addEventListener('error', reject)\n\n        root.appendChild(s)\n    })\n}\n\n\n/**\n * Sets the innerHTML of an element and recreates all script tags so they are executed.\n * @param element - element to set the innerHTML of\n * @param html - innerHTML string to set\n */\nexport async function setInnerHTMLWithScripts(element: HTMLElement, html: string) {\n    element.innerHTML = html\n    const scripts = element.getElementsByTagName('script')\n    // eslint-disable-next-line @typescript-eslint/prefer-for-of\n    for (let i = 0; i < scripts.length; i++) {\n        const script = scripts[i]\n        const newScript = cloneScriptTag(script)\n        let err = false\n        await new Promise(resolve => {\n            newScript.onload = resolve\n            newScript.onerror = () => {\n                err = true\n                resolve(undefined)\n            }\n        })\n        if (err) continue\n        script.parentNode?.replaceChild(newScript, script)\n    }\n}\n\n/**\n * Clones a script tag.\n * @param script - script tag to clone\n * @param newScript - optional new script tag to clone into. If not provided a new script tag will be created.\n */\nexport function cloneScriptTag(script: HTMLScriptElement, newScript?: HTMLScriptElement) {\n    newScript = newScript ?? document.createElement('script')\n    newScript.type = script.type || 'text/javascript'\n    newScript.text = script.text\n    // eslint-disable-next-line @typescript-eslint/prefer-for-of\n    for (let j = 0; j < script.attributes.length; j++) {\n        const attr = script.attributes[ j ]\n        newScript.setAttribute(attr.name, attr.value)\n    }\n    return newScript\n}\n","/**\n * Convert an ArrayBuffer to Base64 string\n * @param buffer - ArrayBuffer to convert\n * @category ArrayBuffer\n */\nexport function arrayBufferToBase64(buffer: ArrayBuffer) {\n    if (!window) {\n        console.warn('window is required')\n        return ''\n    }\n    let binary = ''\n    const bytes = new Uint8Array(buffer)\n    const len = bytes.byteLength\n    for (let i = 0; i < len; i++) {\n        binary += String.fromCharCode(bytes[ i ])\n    }\n    return window.btoa(binary)\n}\n\n/**\n * Convert a Base64 string to ArrayBuffer\n * @param base64 - Base64 string to convert\n * @category ArrayBuffer\n */\nexport function base64ToArrayBuffer(base64: string) {\n    if (!window) {\n        console.warn('window is required')\n        return new Uint8Array(0)\n    }\n    const binaryString = window.atob(base64)\n    const len = binaryString.length\n    const bytes = new Uint8Array(len)\n    for (let i = 0; i < len; i++) {\n        bytes[i] = binaryString.charCodeAt(i)\n    }\n    return bytes.buffer\n}\n\n// if (!ArrayBuffer.prototype.slice)\n//     ArrayBuffer.prototype.slice = function(start, end) {\n//         const that = new Uint8Array(this)\n//         if (end == undefined) end = that.length\n//         const result = new ArrayBuffer(end - start)\n//         const resultArray = new Uint8Array(result)\n//         for (let i = 0; i < resultArray.length; i++)\n//             resultArray[i] = that[i + start]\n//         return result\n//     }\n\n/**\n * Mapping of typed array constructors by name\n * @category ArrayBuffer\n */\nexport const TYPED_ARRAYS = {\n    Int8Array: Int8Array,\n    Uint8Array: Uint8Array,\n    Uint8ClampedArray: Uint8ClampedArray,\n    Int16Array: Int16Array,\n    Uint16Array: Uint16Array,\n    Int32Array: Int32Array,\n    Uint32Array: Uint32Array,\n    Float32Array: Float32Array,\n    Float64Array: Float64Array,\n}\n\n/**\n * Create a typed array from an ArrayBuffer by name\n * @param type - Name of the typed array constructor\n * @param buffer - ArrayBuffer to use\n * @category ArrayBuffer\n */\nexport function getTypedArray(type: keyof typeof TYPED_ARRAYS, buffer: ArrayBuffer) {\n    return new TYPED_ARRAYS[ type ](buffer)\n}\n","/**\n * Convert a string to title case\n * @param str - The string to convert\n *\n * @category Text\n */\nexport function toTitleCase(str: string) {\n    return str.replace(\n        /\\w\\S*/g,\n        function(txt) {\n            return txt.charAt(0).toUpperCase() + txt.substr(1).toLowerCase()\n        }\n    )\n}\n\n/**\n * Convert a string to camel case\n * @param str - The string to convert\n *\n * @category Text\n */\nexport function toCamelCase(str: string) {\n    return str.replace(\n        /([-_][a-z])/ig,\n        ($1) => {\n            return $1.toUpperCase()\n                .replace('-', '')\n                .replace('_', '')\n        }\n    )\n}\n\n/**\n * Parse a file extension from a path\n * @param path - The path to parse\n * @returns file extension without the dot (e.g. 'png')\n *\n * @category Text\n */\nexport function parseFileExtension(path: string): string {\n    if (!path || path === '' || path.match(/__MACOSX\\/.*\\._/)) return '' // todo: proper hidden files checks\n    path = path.replace(/\\?.*$/, '') // remove query string\n\n    const basename = path.split(/[\\\\/]/).pop() ?? '',\n        pos = basename.lastIndexOf('.')\n    if (basename === '' || pos < 1)\n        return ''\n    return basename.slice(pos + 1)\n}\n\n/**\n * Get the filename from a path, similar to PHP's basename()\n * @param url\n *\n * @category Text\n */\nexport function getFilenameFromPath(url: string) {\n    return url.substring(url.lastIndexOf('/') + 1)\n}\n\n/**\n * Escape a string for use in a regular expression\n * @param str\n *\n * @category Text\n */\nexport function escapeRegExp(str: string) {\n    return str.replace(/([.*+?^=!:${}()|[\\]/\\\\])/g, '\\\\$1')\n}\n\n/**\n * Replace all occurrences of a string in another string\n * @param str - The string to search\n * @param find - The string to replace\n * @param replace - The replacement string\n *\n * @category Text\n */\nexport function replaceAll(str: string, find: string, replace: string) {\n    return str.replace(new RegExp(escapeRegExp(find), 'g'), replace)\n}\n\n/**\n * Replace a string in a text, optionally prepending, appending, replacing all occurrences, and/or calling a callback if the string is not found\n * @param source - The source text\n * @param str - The string to replace\n * @param newStr - The replacement string\n * @param replaceAll - Replace all occurrences\n * @param prepend - Prepend the replacement string\n * @param append - Append the replacement string\n * @param notFoundCallback - Callback to call if the string is not found\n */\nexport function safeReplaceString(source: string, str: string, newStr: string, {\n    replaceAll = false,\n    prepend = false,\n    append = false,\n    notFoundCallback = () => {},\n} = {}) {\n    if (notFoundCallback) {\n        if (!source.includes(str)) {\n            notFoundCallback()\n            return source\n        }\n    }\n    let s = newStr\n    if (prepend) {\n        s = newStr + str\n    } else if (append) {\n        s = str + newStr\n    }\n    return replaceAll ? source.replaceAll(str, s) : source.replace(str, s)\n}\n\n/**\n * Find the longest common prefix in an array of strings\n * https://stackoverflow.com/questions/68702774/longest-common-prefix-in-javascript\n * @param words\n */\nexport function longestCommonPrefix(words: string[]): string {\n    words.sort() // shortest string will be first and the longest last\n    return (\n        words[0].split('') // converts shortest word to an array of chars\n            .map((char, idx) => words[words.length - 1][idx] === char ? char : '\\0') // replaces non-matching chars with NULL char\n            .join('') // converts back to a string\n            .split('\\0') // splits the string by NULL characters\n            .at(0) // returns the first part\n        || ''\n    )\n}\n","import {replaceAll} from './text'\n\n/**\n * A template literal tag that does nothing. Useful for syntax highlighting of GLSL code.\n *\n * @example\n * ```js\n * const vertexShader = glsl`\n *    void main() {}\n * `\n * ```\n * @category Template Literals\n */\nexport const glsl = (strings: any, ...rest: any[]) => String.raw({raw: strings} as TemplateStringsArray, ...rest)\n\n/**\n * A template literal tag that does nothing. Useful for syntax highlighting of CSS code.\n *\n * @example\n * ```js\n * const vertexShader = css`\n *    .my-class {\n *        color: red;\n *    }\n * `\n * ```\n * @category Template Literals\n */\nexport const css = (strings: any, ...rest: any[]) => String.raw({raw: strings} as TemplateStringsArray, ...rest)\n\n/**\n * A template literal tag that does nothing. Useful for syntax highlighting of HTML code.\n *\n * @example\n * ```js\n * const vertexShader = html`\n *    <div class=\"my-class\">\n *        <p>Some text</p>\n *    </div>\n * `\n * ```\n * @category Template Literals\n */\nexport const html = (strings: any, ...rest: any[]) => String.raw({raw: strings} as TemplateStringsArray, ...rest)\n\n/**\n * Converts an SVG string to data url. This is useful for creating images from SVGs, or using SVGs in CSS.\n * To use put in template string: ```url(${svgUrl`<svg>...</svg>`})```\n * @param strings - template strings\n * @param rest - template values\n *\n * @example\n * ```typescript\n * const url = svgUrl`\n *  <svg viewBox=\"0 0 100 100\" xmlns=\"http://www.w3.org/2000/svg\"> ... </svg>\n * `\n * console.log(url) // data:image/svg+xml;charset=UTF-8,...\n * ```\n *\n * @category Template Literals\n */\nexport const svgUrl = (strings: any, ...rest: any[]) => {\n    let encoded = String.raw({raw: strings} as TemplateStringsArray, ...rest)\n    encoded = replaceAll(encoded, '%', '%25')\n    encoded = replaceAll(encoded, '> <', '><') // normalise spaces elements\n    encoded = replaceAll(encoded, '; }', ';}') // normalise spaces css\n    encoded = replaceAll(encoded, '<', '%3c')\n    encoded = replaceAll(encoded, '>', '%3e')\n    encoded = replaceAll(encoded, '\"', '\\'')\n    encoded = replaceAll(encoded, '#', '%23') // needed for ie and firefox\n    encoded = replaceAll(encoded, '{', '%7b')\n    encoded = replaceAll(encoded, '}', '%7d')\n    encoded = replaceAll(encoded, '|', '%7c')\n    encoded = replaceAll(encoded, '^', '%5e')\n    encoded = replaceAll(encoded, '`', '%60')\n    encoded = replaceAll(encoded, '@', '%40')\n    encoded = replaceAll(encoded, '&', '&amp;')\n    encoded = replaceAll(encoded, '\\n', '%0A')\n\n    return 'data:image/svg+xml;charset=UTF-8,' + encoded\n}\n","import {createStyles} from \"./dom\";\nimport {css} from \"./template-literals\";\n\n/**\n * Styles the default scrollbar to be more pretty and less intrusive (especially on dark backgrounds), (similar to MacOS)\n */\nexport function prettyScrollbar(root: Element|undefined = document.head){\n    return createStyles(css`\n      ::-webkit-scrollbar\n      {\n        width: 8px;  /* for vertical scrollbars */\n        height: 8px; /* for horizontal scrollbars */\n      }\n      ::-webkit-scrollbar-track\n      {\n        background: rgba(64, 64, 64, 0.4);\n        border-radius: 6px;\n      }\n      ::-webkit-scrollbar-thumb\n      {\n        background: rgba(128, 128, 128, 0.2);\n        border-radius: 6px;\n      }\n      ::-webkit-scrollbar-corner {background: rgba(0,0,0,0.5);}\n    `, root)\n}\n","/**\n * Download a blob as a file in the browser.\n * @param b - blob to download\n * @param name - name of the file\n * @category Browser\n */\nexport function downloadBlob(b: Blob, name: string) {\n    const url = window.URL.createObjectURL(b)\n    const a = document.createElement('a')\n    a.style.display = 'none'\n    a.href = url\n    a.download = name\n    document.body.appendChild(a)\n    a.click()\n    setTimeout(() => {\n        document.body.removeChild(a)\n        window.URL.revokeObjectURL(url)\n    }, 1000)\n}\n\n/**\n * Convert a blob to a data url.\n * @param blob - blob to convert\n * @category Browser\n */\nexport async function blobToDataURL(blob: Blob): Promise<string> {\n    return new Promise<string>((resolve, reject) => {\n        const reader = new FileReader()\n        reader.onload = _e => resolve(reader.result as string)\n        reader.onerror = _e => reject(reader.error)\n        reader.onabort = _e => reject(new Error('Read aborted'))\n        reader.readAsDataURL(blob)\n    })\n}\n\n/**\n * Download a file in the browser.\n * @param b - file to download\n * @param name - name of the file (optional)\n * @category Browser\n */\nexport function downloadFile(b: File, name?: string) {\n    return downloadBlob(b, name ?? b.name)\n}\n\n// todo: add/test options for multiple files and directory upload\n/**\n * Prompt the user to select a file or directory in the browser.\n * @param multiple - allow multiple files\n * @param directory - allow directory\n * @param accept - file types to accept (default: all), e.g. 'image/*'\n * @category Browser\n */\nexport async function uploadFile(multiple = false, directory = false, accept?: string): Promise<File[]> {\n    const input = document.createElement('input')\n    input.type = 'file'\n    input.multiple = multiple\n    input.accept = accept || '*'\n    input.webkitdirectory = directory\n    input.style.display = 'none'\n    document.body.appendChild(input)\n    input.click()\n    const files = await new Promise<File[]>((resolve) => {\n        input.onchange = _e => {\n            resolve(Array.from(input.files || []))\n        }\n    })\n    document.body.removeChild(input)\n    return files\n}\n\n/**\n * Check if the browser is running on a mobile or tablet device.\n */\nexport function mobileAndTabletCheck() {\n    let check = false;\n    // @ts-expect-error copied\n    (function(a) {if (/(android|bb\\d+|meego).+mobile|avantgo|bada\\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\\.(browser|link)|vodafone|wap|windows ce|xda|xiino|android|ipad|playbook|silk/i.test(a) || /1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\\-(n|u)|c55\\/|capi|ccwa|cdm\\-|cell|chtm|cldc|cmd\\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\\-s|devi|dica|dmob|do(c|p)o|ds(12|\\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\\-|_)|g1 u|g560|gene|gf\\-5|g\\-mo|go(\\.w|od)|gr(ad|un)|haie|hcit|hd\\-(m|p|t)|hei\\-|hi(pt|ta)|hp( i|ip)|hs\\-c|ht(c(\\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\\-(20|go|ma)|i230|iac( |\\-|\\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\\/)|klon|kpt |kwc\\-|kyo(c|k)|le(no|xi)|lg( g|\\/(k|l|u)|50|54|\\-[a-w])|libw|lynx|m1\\-w|m3ga|m50\\/|ma(te|ui|xo)|mc(01|21|ca)|m\\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\\-2|po(ck|rt|se)|prox|psio|pt\\-g|qa\\-a|qc(07|12|21|32|60|\\-[2-7]|i\\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\\-|oo|p\\-)|sdk\\/|se(c(\\-|0|1)|47|mc|nd|ri)|sgh\\-|shar|sie(\\-|m)|sk\\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\\-|v\\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\\-|tdg\\-|tel(i|m)|tim\\-|t\\-mo|to(pl|sh)|ts(70|m\\-|m3|m5)|tx\\-9|up(\\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\\-|your|zeto|zte\\-/i.test(a.substr(0, 4))) check = true})(navigator.userAgent || navigator.vendor || window.opera)\n    return check\n}\n","// from three.js\n/**\n * Converts a single color channel from the sRGB color space to linear.\n * @param c - The color channel to be converted.\n * @category Color\n */\nexport function SRGBToLinear( c: number ): number {\n    return ( c < 0.04045 ) ? c * 0.0773993808 : Math.pow( c * 0.9478672986 + 0.0521327014, 2.4 );\n}\n\n/**\n * Converts a single color channel from the linear color space to sRGB.\n * @param c - The color channel to be converted.\n * @category Color\n */\nexport function LinearToSRGB( c: number): number {\n    return ( c < 0.0031308 ) ? c * 12.92 : 1.055 * ( Math.pow( c, 0.41666 ) ) - 0.055;\n}\n\n/**\n * Creates an image data url from a color string.\n * @param color - color string (css compatible color)\n * @param width - width of the image (default: 1)\n * @param height - height of the image (default: 1)\n * @return data url\n */\nexport function colorToDataUrl(color: string, width = 1, height = 1){\n    const canvas = document.createElement('canvas')\n    canvas.width = width\n    canvas.height = height\n    const ctx = canvas.getContext('2d')!\n    ctx.fillStyle = '#' + color\n    ctx.fillRect(0, 0, width, height)\n    const url = canvas.toDataURL()\n    canvas.remove()\n    return url\n}\n","import {AnyOptions, ValOrFunc} from \"./types\";\n\n/**\n * Get property descriptor from object or its prototype chain\n * @param obj\n * @param prop\n *\n * @category JS Object\n */\nexport function getPropertyDescriptor<T>(obj: T, prop: keyof T) : PropertyDescriptor | undefined {\n    let desc\n    do {\n        desc = Object.getOwnPropertyDescriptor(obj, prop)\n    } while (!desc && (obj = Object.getPrototypeOf(obj)))\n    return desc\n}\n\n/**\n * Check if property is writable in object or its prototype chain\n * @param object - object to check\n * @param prop - property to check\n * @param allowWritable - allow writable properties without setter\n * @param allowAny - allow any property (even if it doesn't exist)\n *\n * @category JS Object\n */\nexport function isPropertyWritable<T>(object: T, prop: keyof T, allowWritable = true, allowAny = false) {\n    const desc = getPropertyDescriptor(object, prop)\n    return !!desc?.set\n        || allowWritable && desc?.writable !== false && desc?.get === undefined\n        || allowAny && !desc\n}\n\n/**\n * Set value only if setter exists\n * @param object - object to set\n * @param prop - property to set\n * @param value - value to set\n * @param allowWritable - allow writable properties without setter\n * @param allowAny - allow any property (even if it doesn't exist)\n *\n * @category JS Object\n */\nexport function safeSetProperty<T, K extends keyof T>(object: T | undefined | null, prop: K, value: NonNullable<T>[K], allowWritable = true, allowAny = false): boolean {\n    // check type?\n    if (object && isPropertyWritable(object, prop, allowWritable, allowAny)) {\n        object[prop] = value\n        return true\n    }\n    return false\n}\n\n/**\n * Get value, but if it is a function, call it with args\n * @param s - value or function\n * @param args - arguments to pass to function\n *\n * @category JS Object\n */\nexport function getOrCall<T>(s: ValOrFunc<T | undefined>, ...args: any[]): T|undefined {\n    if (typeof s === 'function') s = (s as ((...a:any[])=>T|undefined))(...args)\n    return s\n}\n\n/**\n * Copy properties from source to dest. Similar to Object.assign, but only copies properties that exist in source, dest and propList.\n * @param source - source object\n * @param dest - destination object\n * @param propList - list of properties to copy\n *\n * @category JS Object\n */\nexport function copyProps<T = AnyOptions>(source: Record<keyof T, any>, dest: T, propList: (keyof T)[]): T {\n    for (const str of propList) {\n        const s = source[str]\n        if (s !== undefined) safeSetProperty(dest, str, s, true)\n        // if (s !== undefined) dest[str] = s\n    }\n    return dest\n}\n","import {AnyFunction} from './types'\n\n/**\n * Returns true if the array includes all the elements of the sub array\n * @param arr\n * @param subArr\n */\nexport function includesAll(arr: any[], subArr: IterableIterator<any>) {\n    for (const sub of subArr) {\n        if (!arr.includes(sub)) return false\n    }\n    return true\n}\n\n/**\n * like Array.prototype.findIndex but from the end\n * @param arr\n * @param predicate\n */\nexport function findLastIndex<T>(arr: T[], predicate: (v: T)=>boolean){\n    for (let i = arr.length-1; i >= 0; i--) {\n        if (predicate(arr[i])) return i\n    }\n    return -1\n}\n\n/**\n * Call f1 before calling f2\n * Sample usage\n * ```\n * const logRender = ()=>console.log('render')\n * obj.render = wrapThisFunction(logRender, obj.beforeRender)\n * // now calling obj.beforeRender(), will log 'render' and then call obj.beforeRender()\n * ```\n * @param f1\n * @param f2\n */\nexport function wrapThisFunction<T extends AnyFunction, T2>(f1: ()=>void, f2?: T): T {\n    return function(this: T2, ...args: Parameters<T>) {\n        f1()\n        return f2 && f2.call(this, ...args)\n    } as T\n}\n\n/**\n * Call f1 with the same params as f2 before calling f2\n * Sample usage\n * ```\n * const logRender = ()=>console.log('render')\n * obj.render = wrapThisFunction(logRender, obj.beforeRender)\n * // now calling obj.beforeRender(), will log 'render' and then call obj.beforeRender()\n * ```\n * @param f1\n * @param f2\n */\nexport function wrapThisFunction2<T extends AnyFunction, T2>(f1: T, f2?: T): T {\n    return function(this: T2, ...args: Parameters<T>) {\n        f1(...args)\n        return f2 && f2.call(this, ...args)\n    } as T\n}\n","/**\n * Access property in an object using a string path. Similar to lodash.get\n * @param access - path to access\n * @param tar - target object\n * @param throwOnInvalid - throw error if invalid access or property is undefined. Default is false\n *\n * @example\n * ```js\n * const obj = {a: {b: {c: 1}}}\n * const c = deepAccessObject(['a', 'b', 'c'], obj)\n * console.log(c) // 1\n * ```\n *\n * @category JS Object\n */\nexport function deepAccessObject(access: string | string[], tar: any, throwOnInvalid = false): any {\n    if (typeof access === 'string') access = access.split('.')\n    while (access.length > 0) {\n        if (!tar) return tar\n        const p = access.splice(0, 1)[0] as string\n        if (p.length < 1) continue\n        if (Array.isArray(tar)) {\n            tar = tar[parseInt(p)]\n        }else if (typeof tar==='object' && p in tar) {\n            tar = tar[p]\n        } else {\n            // console.error('invalid access, check', p, tar)\n            if (throwOnInvalid)\n                throw new Error('invalid access, check ' + p + ' in ' + tar)\n            else return undefined\n            // return tar\n        }\n    }\n    return tar\n}\n\n\n/**\n * Find the key of an object with a given value.\n * @param object - object to search\n * @param value - value to search for\n *\n * @category JS Object\n */\nexport function getKeyByValue(object: Record<string, any>, value: any): string|undefined {\n    return Object.keys(object).find(key => object[key] === value)\n}\n\n/**\n * Check if an object has a property. Same as {@link Object.hasOwn} or {@link Object.hasOwnProperty}\n * @param o\n * @param v\n */\nexport function objectHasOwn(o: object, v: PropertyKey): boolean {\n    return Object.hasOwn ? Object.hasOwn(o, v) : o.hasOwnProperty(v)\n}\n\n/**\n * Execute a function on each property of an object and return the result as a new object\n * This allows in place modification of the object.\n * To create a new object, set inPlace to false, or use {@link objectMap2} to modify the keys as well\n * Similar to {@link Array.map} but for objects.\n * @param obj - object\n * @param fn - function to execute on each property\n * @param inPlace - if true, the original object is modified. Default is true\n */\nexport function objectMap<T extends string|number|symbol, V>(obj: Record<T, V>, fn: (val: V, key: T)=>V, inPlace = true): Record<T, V> {\n    const result: any = inPlace ? obj : {}\n    const keys = Object.keys(obj) as T[]\n    for (const key of keys) result[key] = fn(obj[key], key)\n    return result\n}\n\n/**\n * Shorthand for `Object.fromEntries(Object.entries(obj).map(fn))`\n * Similar to {@link objectMap} but uses {@link Object.fromEntries} to create the new object, so keys can also be changed.\n * @param obj\n * @param fn\n */\nexport function objectMap2<T extends string|number|symbol, V = any>(obj: Record<T, V>, fn: ([key, val]: [T, V])=>[T, V]): Record<T, V> {\n    return Object.fromEntries((Object.entries(obj) as [T, V][]).map((v: [T, V])=>fn(v))) as Record<T, V>\n}\n\n","import {safeSetProperty} from './obj-property'\nimport {findLastIndex} from './misc'\nimport {objectMap2} from './object'\n\n/**\n * Serializer interface for primitive, array and struct/custom object types\n * @category Serialization\n */\nexport interface Serializer{\n    serialize: (obj: any, meta?: any) => any\n    deserialize: (data: any, obj: any, meta?: any) => any // todo: handle when data is already deserialized for Texture, Material etc\n    isType: (obj: any) => boolean\n    priority?: number // lower priority serializers are checked first\n}\n\nconst objSerializer: Serializer = { // object\n    priority: Infinity,\n    serialize: (obj: any, meta?: any)=> objectMap2(obj, ([k, v]) => [k, Serialization.Serialize(v, meta, false)]),\n    deserialize: (data: any, obj: any, meta: any)=>\n        Object.assign(obj||{}, objectMap2(data, ([k, v]) => [k, Serialization.Deserialize(v, obj?.[k], meta, false)])),\n    isType: (obj: any) => (obj.constructor||Object) === Object,\n}\n/**\n * Serialization class with static methods for serializing and deserializing objects.\n * Properties and classes can be marked serializable by adding {@link serialize} and {@link serializable} decorators.\n * @category Serialization\n */\nexport class Serialization{\n    static TypeMap = new Map<ObjectConstructor, [string, string][]>()\n    static SerializableClasses = new Map<string, any>()\n\n    /**\n     * Serializers for primitive, array and struct/custom object types\n     */\n    static Serializers: Serializer[] = [\n        { // arrays\n            priority: 0,\n            isType: (obj: any) => Array.isArray(obj),\n            serialize: (obj: any, meta?: any)=> obj.map((v: any) => Serialization.Serialize(v, meta, false)),\n            deserialize: (data: any, obj: any, meta: any)=>{\n                const l = data.length\n                if (!Array.isArray(obj)) obj = []\n                for (let i = 0; i < l; i++) {\n                    const d = data[i]\n                    const de = obj.length > i ? Serialization.Deserialize(d, obj[i], meta, false) : Serialization.Deserialize(d, undefined, meta, false)\n                    if (obj.length <= i) obj.push(de)\n                    else obj[i] = de\n                }\n                return obj\n            },\n        },\n        { // primitives\n            priority: 0,\n            isType: (obj: any) => !obj || typeof obj !== 'object',\n            serialize: (obj: any)=> {\n                if (obj && typeof obj === 'number') {\n                    if (obj === Infinity) return 'Infinity'\n                    if (obj === -Infinity) return '-Infinity'\n                    if (isNaN(obj)) return 'NaN'\n                }\n                return obj\n            },\n            deserialize: (data: any, obj: any)=>{\n                if (typeof obj === 'number') {\n                    if (data === 'Infinity') return Infinity as any\n                    if (data === '-Infinity') return -Infinity as any\n                    if (data === 'NaN') return NaN as any\n\n                    if (typeof data === 'number' || !data) return data\n                }\n                return data\n            },\n        },\n        objSerializer,\n    ]\n\n    static GetSerializer(obj: any){\n        return Serialization.Serializers.find(s => s.isType(obj))\n    }\n\n    static RegisterSerializer(...serializers: Serializer[]){\n        for (const serializer of serializers) {\n            const priority = serializer.priority ?? 1e10\n            const i = findLastIndex(Serialization.Serializers, s => s.priority !== undefined && s.priority < priority)\n            if (i >= 0) Serialization.Serializers.splice(i+1, 0, serializer)\n            else Serialization.Serializers.push(serializer)\n        }\n    }\n\n    static UnregisterSerializer(...serializers: Serializer[]){\n        for (const serializer of serializers) {\n            const i = Serialization.Serializers.indexOf(serializer)\n            if (i >= 0) Serialization.Serializers.splice(i, 1)\n        }\n    }\n\n\n    /**\n     * Serialize an object\n     * @param obj - object to serialize\n     * @param meta - Optional object to store common meta-data/resources across the serialization process of multiple objects\n     * @param isThis - true if called from inside the serialization function, like custom {@link IJSONSerializable.toJSON}.\n     */\n    static Serialize(obj: any, meta?: Record<string, Record<string, any>>, isThis = false){\n        if (typeof obj === 'function') return undefined\n\n        if(!isThis) {\n            const serializer = Serialization.GetSerializer(obj)\n            if (serializer) return serializer.serialize(obj, meta)\n\n            // Handle classes with explicit serialization with toJSON and fromJSON functions\n            // toJSON functions can call Serialize(with isThis=true) to serialize the properties with @serialize decorator\n            if (typeof obj.toJSON === 'function') {\n                const res = obj.toJSON(meta, true)\n                if (obj.serializableClassId && res) res.serializableClassId = obj.serializableClassId\n                return res\n            }\n        }\n\n        // Handle classes with @serializable decorator and serialize all properties with @serialize decorator\n        let type = obj.constructor ?? Object\n        const result: any = {}\n        // Loop through all parent classes and serialize properties with @serialize decorator\n        while (type && type !== Object) {\n            const Type = Serialization.TypeMap.get(type) ?? []\n            for (const [key, propKey] of Type) {\n                result[key] = Serialization.Serialize(obj[propKey], meta, false)\n            }\n            type = Object.getPrototypeOf(type)\n        }\n        if (obj.serializableClassId) result.serializableClassId = obj.serializableClassId\n        return result\n    }\n\n    /**\n     * Deserialize an object\n     * @param data - data to deserialize\n     * @param obj - current object that's set. If of the same class/type the data is deserialized into that instead of creating new objects.\n     * @param meta - Optional object to retrieve common meta-data/resources across the deserialization process of multiple objects. Objects in meta must be class instances, not js objects. (like Material, Texture, Object3D etc)\n     * @param isThis - true if called from inside the deserialization function, like custom {@link IJSONSerializable.fromJSON}\n     */\n    static Deserialize(data: any, obj: any, meta?: Record<string, any>, isThis = false){\n        if (data === undefined) return obj // undefined is not deserialized\n        if(obj === data) return obj // same object\n\n        // let isResource = false\n        // If data is an embedded resource in meta\n        if(data && typeof data === 'object' && (data.constructor||Object) === Object && data.resource && typeof data.resource === 'string' && data.uuid){\n            const res = meta?.[data.resource]\n            if(res) {\n                // isResource = true\n                data = res[data.uuid]\n                if(typeof data === 'object') {\n                    data.__useCount = data.__useCount ? data.__useCount + 1 : 1 // used for materials for now, see AssetManagerPlugin.importViewerConfig\n                }\n                if(!data) console.warn(`Resource ${data.resource} with uuid ${data.uuid} not found`)\n                if(obj === data) return obj // same object\n                if(data && typeof data === 'object' ) {\n                    const isDeserializedClass = (data.constructor||Object) !== Object // data is already deserialized\n                    if(isDeserializedClass) {\n                        if (!obj) {\n                            return data\n                        } else {\n                            // todo: if data is deserialized already and !== obj.\n                            // obj is not null, could be a Texture, Material, Object etc\n                            // should we ignore the current object and assign one from meta or copy data from meta to current object\n                            // for textures, it should be replaced. should we copy if uuid is same?\n                            // for materials, if uuid is same and type is same it should be copied otherwise replaced\n                            // for vector3d, copy data\n                            // todo: need to implement.\n                            console.warn(\"replacing object\", obj, 'with deserialized object from meta', data)\n                            return data;\n                        }\n                    }else { // data is not deserialized, or is a normal object\n                        // this is not supported. meta should only have class instances, not js objects\n                        console.error('Deserialize; meta should only have class instances, not js objects', data, obj, meta)\n                        if(!obj){\n                            // continue deserializing and return deserialized - done\n                        }else {\n                            // continue deserializing then copy to current obj?\n                        }\n                    }\n                }\n            }\n            else {\n                console.warn(`Resource ${data.resource} not found`)\n                return obj\n            }\n        }\n        if(data && typeof data === 'object' && (data.constructor||Object) !== Object && !Array.isArray(data) && !data.serializableClassId){\n            if(data instanceof Blob) return data // todo special check for Blob/File\n\n            console.warn('Data might already be deserialized. It will be cloned, or copied to source', data, \"source\", obj, data.constructor, data.constructor !== Object)\n        }\n\n        // todo handle File/Blob and FS API descriptors (try loading SheenChair.glb from three,js in threepipe)\n\n        // Create new object if not provided\n        if (data && typeof data === 'object') {\n            // if data is deserialized already and obj is null. then should we clone the data or assign it directly?\n            // if it's a resource from meta then assign it directly(done above), otherwise clone (done just below).\n            if (data.serializableClassId && (!obj || obj.serializableClassId !==data.serializableClassId) ) { // if the data is already deserialized, it will be cloned\n                const constructor = Serialization.SerializableClasses.get(data.serializableClassId)\n                if (constructor) {\n                    if (constructor.DataInConstructor) // not used anywhere right now. todo: remove? because we are anyway assigning the data to the object after the constructor using @serialize and support fromJSON\n                        obj = new constructor(data)\n                    else obj = new constructor()\n                }\n            } else if ((data.constructor||Object) === Object && !obj) {\n                obj = {}\n            } else if (Array.isArray(data) && !obj) {\n                obj = []\n            }\n        }\n        if (typeof obj === 'function') {\n            console.error('cannot deserialize a function', obj, data)\n            return obj // throw error maybe?}\n        }\n\n        if(!isThis) {\n            const serializer = Serialization.GetSerializer(data)\n            if (serializer && serializer !== objSerializer) return serializer.deserialize(data, obj, meta)\n        }\n\n        if (!data || obj === undefined || obj === null || typeof obj !== 'object') {\n            return data\n        }\n\n        // Handle classes with explicit serialization with toJSON and fromJSON functions\n        // fromJSON functions can call Deserialize(with isThis=true) to deserialize the properties with @serialize decorator\n        if (!isThis && typeof obj?.fromJSON === 'function') {\n            obj.fromJSON(data, meta, true)\n            return obj // cannot be sure what the return value is\n        }\n\n        let type = obj.constructor ?? Object\n\n        if(type === Object) return objSerializer.deserialize(data, obj, meta)\n\n        // Loop through all parent classes and deserialize properties with @serialize decorator\n        while (type && type !== Object) {\n            const Type = Serialization.TypeMap.get(type) ?? []\n            for (const [key, propKey] of Type) {\n                const current = obj[propKey]\n                const newVal = Serialization.Deserialize(data[key], current, meta, false)\n                if (newVal !== current) safeSetProperty(obj, propKey as any, newVal, true)\n            }\n            type = Object.getPrototypeOf(type)\n        }\n        return obj\n\n    }\n\n}\n","import {AnyFunction} from './types'\n\n/**\n * calls fn.call(obj) or fn() appropriately\n *\n * @category JS Object\n */\nexport class FnCaller {\n    private static methodMap = new WeakMap<object, WeakMap<Function, boolean>>();\n\n    static callFunction(fn: AnyFunction, obj?: Record<string|symbol, any>, params: any[] = []) {\n        if (!obj) return fn(...params)\n        if (fn.name && obj[fn.name] === fn) return fn.call(obj, ...params)\n        // all this is required because of minification, there fn.name is mangled. To test, minify and mangle with webpack\n        if (!FnCaller.methodMap.has(obj)) FnCaller.methodMap.set(obj, new WeakMap<Function, boolean>());\n        const methods = FnCaller.methodMap.get(obj)!;\n        if (!methods.has(fn)) {\n            let p = obj\n            while(p){\n                const descp = Object.values(Object.getOwnPropertyDescriptors(p)) as PropertyDescriptor[];\n                // we need to loop over descriptors and we cannot access the value to check because that will call any getters for no reason\n                for(let desc of descp){\n                    if (desc.value !== fn) continue;\n                    methods.set(fn, true);\n                    return fn.call(obj, ...params);\n                }\n                p = Object.getPrototypeOf(p);\n            }\n            methods.set(fn, false);\n        }\n        return methods.get(fn) ? fn.call(obj, ...params) : fn(...params);\n    }\n}\n","import {AnyFunction} from \"./types\";\nimport {Serialization} from './serialization'\nimport {objectHasOwn} from './object'\nimport {FnCaller} from './fnCaller'\n\n/**\n * Decorator that redefines a property with getter and setter, and calls a function when the property is changed.\n * Parameters passed to the function are the property key and the new value.\n * @note - Does not work with \"target\": \"esnext\" in tsconfig.json\n * @note - Requires \"experimentalDecorators\": true in tsconfig.json\n * @todo add example.\n * @param fnKey - use: `<MyClass>.prototype.<myFunction>` or define an arrow function: `(key, value, oldValue, target) => {}`.\n * @param paramType -\n * if param, the function is called with 4 parameters: `key, value, oldValue, target`, default for {@link onChange}\n * if object, the function is called with an object parameter: `{key, value, oldValue, target}`, default for {@link onChange3}\n * if void then no params are passed. {@link onChange2}\n * Default: false.\n *\n * @category Decorators\n */\nexport function onChange<TTarget = any>(\n    fnKey: string |\n        ((key: string, value: any, oldValue: any, target: TTarget)=>void) // target is this\n        //| ((obj:{key: string, value: any, oldValue: any, target: TTarget})=>void)\n    , paramType: 'param'|'object'|'void' = 'param'): PropertyDecorator {\n    if (!fnKey) throw new Error('onChange: fnKey is undefined, make sure the function exists or provide a string')\n    return (targetPrototype: any, propertyKey: string|symbol, descriptor?: TypedPropertyDescriptor<any>) => {\n        const prop = {\n            get() {\n                return this[`_oc_${propertyKey as string}`]\n            },\n            set(newVal: any) {\n                const oldVal = this[`_oc_${propertyKey as string}`]\n                if (oldVal === newVal) return\n                this[`_oc_${propertyKey as string}`] = newVal\n                const params = paramType === 'param' ? [propertyKey, newVal, oldVal, this] : paramType === 'object' ? [{key: propertyKey, value: newVal, oldValue: oldVal, target: this}] : []\n                if (typeof fnKey === 'string') this[fnKey]?.call(this, ...params)\n                else if (typeof fnKey === 'function') FnCaller.callFunction(fnKey, this, params)\n            },\n        } as any\n        // babel(in react-scripts) - https://github.com/babel/babel/blob/909ed3473968c2ccd75f89e17c37ef4771cc3ff8/packages/babel-helpers/src/helpers/applyDecoratedDescriptor.ts#L11\n        if (descriptor) {\n            if (objectHasOwn(descriptor, 'value')) delete descriptor.value\n            if (objectHasOwn(descriptor, 'writable')) delete descriptor.writable\n            if (objectHasOwn(descriptor, 'initializer')) delete (descriptor as any).initializer\n            return Object.assign(descriptor, prop)\n        }\n        Object.defineProperty(targetPrototype, propertyKey, prop)\n    }\n}\n\n/**\n * Similar to {@link onChange}, but accepts any function and paramType defaults to 'void'. The function is called with no parameters. if 'void'\n * @param fnKey\n * @param paramType\n */\nexport function onChange2(\n    fnKey: string|AnyFunction,\n    paramType: 'param'|'object'|'void' = 'void'): PropertyDecorator {\n    if (!fnKey) throw new Error('onChange: fnKey is undefined, make sure the function exists or provide a string')\n    return onChange(fnKey, paramType)\n}\n\n/**\n * Similar to {@link onChange}, but accepts any function and paramType defaults to 'object'. The function is called with an object parameter: `{key, value, oldValue, target}`.\n * @param fnKey\n * @param paramType\n */\nexport function onChange3<TTarget = any>(\n    fnKey: string|((obj:{key: string, value: any, oldValue: any, target: TTarget})=>void),\n    paramType: 'object'|'void' = 'object'): PropertyDecorator {\n    if (!fnKey) throw new Error('onChange: fnKey is undefined, make sure the function exists or provide a string')\n    return onChange<TTarget>(fnKey as any, paramType)\n}\n\n/**\n * Similar to onChange but dispatches an event instead of calling a function.\n * Requires `dispatchEvent` to be defined on the target.\n * @param eventName - The name of the event to dispatch. Default: '`key`-changed'\n */\nexport function onChangeDispatchEvent(eventName?: string): PropertyDecorator {\n    return onChange((key, value, oldValue, target) => {\n        if(!target.dispatchEvent) throw new Error('onChangeDispatchEvent: target does not have dispatchEvent')\n        target.dispatchEvent({type: eventName || `${key}-changed`, detail: {key, value, oldValue}})\n    }, 'param')\n}\n\n/**\n * Decorator to mark a class property as serializable using the {@link Serialization} class.\n * @note - Requires \"experimentalDecorators\": true in tsconfig.json\n * @param key - The key to use when serializing the property. If not provided, the property name is used (for this make sure the property name is not mangled during minification).\n * @category Decorators\n */\nexport function serialize(key?: string): PropertyDecorator {\n    return (targetPrototype: any, propertyKey: string|symbol) => {\n        const type = targetPrototype.constructor\n        if (type === Object) throw new Error('All properties in an object are serialized by default')\n        if (!Serialization.TypeMap.has(type)) Serialization.TypeMap.set(type, [])\n\n        Serialization.TypeMap.get(type)!.push([key || propertyKey as string, propertyKey as string])\n    }\n}\n\n/**\n * Decorator to mark a class as serializable using the {@link Serialization} class.\n * @note - Requires \"experimentalDecorators\": true in tsconfig.json\n * @param id - The id to use when serializing the class. This is used to identify the class when deserializing. Class names can be mangled during minification, so it is required to provide an id.\n */\nexport function serializable(id: string) {\n    return <T extends new (...args: any[]) => any>(constructor: T) =>{\n        constructor = class extends constructor {\n            // noinspection JSUnusedGlobalSymbols\n            readonly serializableClassId = id\n            // static DataInConstructor = false // if constructor is equivalent to fromJSON, see LUTCubeTextureWrapper.\n        }\n        Serialization.SerializableClasses.set(id, constructor)\n        return constructor\n    }\n}\n","/**\n * Encrypts plaintext using AES-GCM with supplied password, for decryption with aesGcmDecrypt().\n *                                                                      (c) Chris Veness MIT Licence\n * https://gist.github.com/chrisveness/43bcda93af9f646d083fad678071b90a\n * Modified to work with Uint8Array and string content.\n *\n * @param content - Plaintext or Uint8 Buffer to be encrypted.\n * @param password - Plaintext or Uint8 Buffer Password to use to encrypt content.\n * @param prefix - Optional prefix to prepend to the ciphertext.\n * @returns Encrypted ciphertext. If content is a string, the ciphertext is a string. If content is a Uint8Array, the ciphertext is a new Uint8Array.\n *\n *\n * @example\n *   const ciphertext = await aesGcmEncrypt('my secret text', 'pw');\n *   aesGcmEncrypt('my secret text', 'pw').then(function(ciphertext) { console.log(ciphertext); });\n *\n * @category Encryption\n */\nexport async function aesGcmEncrypt<T extends string|Uint8Array>(content: T, password: string|Uint8Array, prefix?: string | Uint8Array): Promise<T> {\n    const pwUtf8 = typeof password === 'string' ? new TextEncoder().encode(password) : password // encode password as UTF-8\n    const pwHash = await crypto.subtle.digest('SHA-256', pwUtf8) // hash the password\n\n    const iv = crypto.getRandomValues(new Uint8Array(12)) // get 96-bit random iv\n    const ivStr = Array.from(iv).map(b => String.fromCharCode(b)).join('') // iv as utf-8 string\n\n    const alg = {name: 'AES-GCM', iv: iv} // specify algorithm to use\n\n    const key = await crypto.subtle.importKey('raw', pwHash, alg, false, ['encrypt']) // generate key from pw\n\n    const ptUint8 = typeof content === 'string' ? new TextEncoder().encode(content) : content as Uint8Array // encode plaintext as UTF-8\n    const ctBuffer = await crypto.subtle.encrypt(alg, key, ptUint8) // encrypt plaintext using key\n\n    const ctUint = new Uint8Array(ctBuffer)\n    const ctArray = Array.from(ctUint) // ciphertext as byte array\n    const ctStr = ctArray.map(byte => String.fromCharCode(byte)).join('') // ciphertext as string\n\n    const prefixStr = prefix ? typeof prefix === 'string' ? prefix : new TextDecoder().decode(prefix) : ''\n    const prefixArray = prefix ? typeof prefix === 'string' ? new TextEncoder().encode(prefix) : Array.from(prefix) : []\n    return typeof content === 'string' ? (prefixStr + ivStr + ctStr) as T : new Uint8Array([...prefixArray, ...iv, ...ctArray]) as T\n}\n\n\n/**\n * Decrypts ciphertext encrypted with aesGcmEncrypt() using supplied password.\n *                                                                      (c) Chris Veness MIT Licence\n *\n * https://gist.github.com/chrisveness/43bcda93af9f646d083fad678071b90a\n * Modified to work with Uint8Array and string content.\n *\n * @param ciphertext - Ciphertext to be decrypted.\n * @param password - Password to use to decrypt ciphertext.\n * @returns Decrypted content. If ciphertext is a string, the plaintext is a string. If ciphertext is a Uint8Array, the plaintext is a new Uint8Array.\n *\n * @example\n *   const plaintext = await aesGcmDecrypt(ciphertext, 'pw');\n *   aesGcmDecrypt(ciphertext, 'pw').then(function(plaintext) { console.log(plaintext); });\n *\n * @category Encryption\n */\nexport async function aesGcmDecrypt<T extends string|Uint8Array>(ciphertext: T, password: string|Uint8Array): Promise<T> {\n    const pwUtf8 = typeof password === 'string' ? new TextEncoder().encode(password) : password // encode password as UTF-8\n    const pwHash = await crypto.subtle.digest('SHA-256', pwUtf8) // hash the password\n\n    const ivStr = ciphertext.slice(0, 12)\n    const iv = typeof ivStr === 'string' ? new Uint8Array(Array.from(ivStr).map(ch => ch.charCodeAt(0))) : ivStr // decode base64 iv\n\n    const alg = {name: 'AES-GCM', iv: iv} // specify algorithm to use\n\n    const key = await crypto.subtle.importKey('raw', pwHash, alg, false, ['decrypt']) // generate key from pw\n\n    const ctStr = ciphertext.slice(12)\n    const ctUint8 = typeof ctStr === 'string' ? new Uint8Array(Array.from(ctStr).map(ch => ch.charCodeAt(0))) : ctStr\n    // note: why doesn't ctUint8 = new TextEncoder().encode(ctStr) work?\n\n    try {\n        const plainBuffer = await crypto.subtle.decrypt(alg, key, ctUint8) // decrypt ciphertext using key\n        return typeof ciphertext === 'string' ? new TextDecoder().decode(plainBuffer) as T : new Uint8Array(plainBuffer) as T\n    } catch (e) {\n        throw new Error('Decrypt failed')\n    }\n}\n","/**\n * Copyright 2019 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * Modified from: https://github.com/GoogleChromeLabs/text-editor/blob/main/src/inline-scripts/fs-helpers.js\n */\n\n/**\n * Open a handle to an existing file on the local file system.\n *\n * @return {!Promise<FileSystemFileHandle>} Handle to the existing file.\n */\nexport async function getFileHandle(): Promise<FileSystemFileHandle> {\n    // For Chrome 86 and later...\n    if ('showOpenFilePicker' in window) {\n        return window.showOpenFilePicker().then((handles) => handles[0]);\n    }\n    // For Chrome 85 and earlier...\n    return (window as any).chooseFileSystemEntries();\n}\n\n/**\n * Create a handle to a new (text) file on the local file system.\n *\n * @return {!Promise<FileSystemFileHandle>} Handle to the new file.\n */\nexport function getNewFileHandle(): Promise<FileSystemFileHandle> {\n    // For Chrome 86 and later...\n    if ('showSaveFilePicker' in window) {\n        const opts = {\n            types: [{\n                description: 'Text file',\n                accept: {'text/plain': ['.txt']},\n            }],\n        };\n        return window.showSaveFilePicker(opts);\n    }\n    // For Chrome 85 and earlier...\n    const opts = {\n        type: 'save-file',\n        accepts: [{\n            description: 'Text file',\n            extensions: ['txt'],\n            mimeTypes: ['text/plain'],\n        }],\n    };\n    return (window as any).chooseFileSystemEntries(opts);\n}\n\n/**\n * Reads the raw text from a file.\n *\n * @param {File} file\n * @return {!Promise<string>} A promise that resolves to the parsed string.\n */\nexport function readFile(file: File): Promise<string> {\n    // If the new .text() reader is available, use it.\n    if (file.text) {\n        return file.text();\n    }\n    // Otherwise use the traditional file reading technique.\n    return _readFileLegacy(file);\n}\n\n/**\n * Reads the raw text from a file.\n *\n * @private\n * @param {File} file\n * @return {Promise<string>} A promise that resolves to the parsed string.\n */\nfunction _readFileLegacy(file: File): Promise<string> {\n    return new Promise((resolve) => {\n        const reader = new FileReader();\n        reader.addEventListener('loadend', (e) => {\n            const text = (e.srcElement as any || e.target).result;\n            resolve(text);\n        });\n        reader.readAsText(file);\n    });\n}\n\n/**\n * Writes the contents to disk.\n *\n * @param {FileSystemFileHandle} fileHandle File handle to write to.\n * @param {string} contents Contents to write.\n */\nexport async function writeFile(fileHandle: FileSystemFileHandle, contents: FileSystemWriteChunkType) {\n    // Support for Chrome 82 and earlier.\n    if ((fileHandle as any).createWriter) {\n        // Create a writer (request permission if necessary).\n        const writer = await (fileHandle as any).createWriter()\n        // Write the full length of the contents\n        await writer.write(0, contents)\n        // Close the file and write the contents to disk\n        await writer.close()\n        return\n    }\n    // For Chrome 83 and later.\n    // Create a FileSystemWritableFileStream to write to.\n    const writable = await fileHandle.createWritable()\n    // Write the contents of the file to the stream.\n    await writable.write(contents as any)\n    // Close the file and write the contents to disk.\n    await writable.close()\n}\n\n/**\n * Verify the user has granted permission to read or write to the file, if\n * permission hasn't been granted, request permission.\n *\n * @param fileHandle File handle to check.\n * @param withWrite True if write permission should be checked.\n * @return True if the user has granted read/write permission.\n */\nexport async function verifyPermission(fileHandle: FileSystemFileHandle, withWrite: boolean) {\n    const opts: any = {}\n    if (withWrite) {\n        opts.writable = true\n        // For Chrome 86 and later...\n        opts.mode = 'readwrite'\n    }\n    // Check if we already have permission, if so, return true.\n    if (await fileHandle.queryPermission(opts) === 'granted') {\n        return true\n    }\n    // Request permission to the file, if the user grants permission, return true.\n    if (await fileHandle.requestPermission(opts) === 'granted') {\n        return true\n    }\n    // The user did nt grant permission, return false.\n    return false\n}\n\n","/**\n * Convert an image {@link ImageBitmap} or {@link CanvasImageSource} to a new canvas with a max width. Good for resizing images keeping the aspect ratio and generating previews.\n * @param bitmap - image to convert\n * @param maxWidth - maximum width of the image (default: 8192). Images larger than this will be scaled down. This is because strings can get too long.\n * @param detachBitmap - detach the bitmap after conversion (default: false). This will free up bitmap memory if you don't need it anymore.\n *\n * See also {@link imageUrlToImageData}, {@link imageBitmapToBase64}, {@link imageBitmapToBlob}\n *\n * @category Images\n */\nexport function imageBitmapToCanvas(bitmap: ImageBitmap | CanvasImageSource | any, maxWidth = 8192, detachBitmap = false): HTMLCanvasElement {\n    if (!bitmap.width || !bitmap.height) throw new Error('Invalid bitmap')\n\n    // create a canvas\n    const canvas = document.createElement('canvas')\n    // resize it to the size of our ImageBitmap\n    canvas.width = Math.min(maxWidth, bitmap.width as number)\n    canvas.height = Math.floor(1.0 + canvas.width * (bitmap.height as number) / (bitmap.width as number))\n\n    // try to get a bitmaprenderer context if same size\n    const isBitmap = bitmap instanceof ImageBitmap\n    const ctx = isBitmap && detachBitmap && Math.abs(canvas.width - bitmap.width) < 0.5 ? canvas.getContext('bitmaprenderer') : undefined\n    if (ctx) {\n        // transfer the ImageBitmap to it\n        ctx.transferFromImageBitmap(bitmap as ImageBitmap) // less memory but it will detach the bitmap\n    } else {\n        // in case someone supports createImageBitmap only\n        // twice in memory...\n        canvas.getContext('2d')?.drawImage(bitmap, 0, 0, canvas.width, canvas.height)\n    }\n    if (isBitmap && detachBitmap) {\n        bitmap.close()\n    }\n    return canvas\n}\n\n/**\n * Convert an image {@link ImageBitmap} or {@link CanvasImageSource} to a base64 data url.\n * @param bitmap - image to convert\n * @param maxWidth - maximum width of the image (default: 8192). Images larger than this will be scaled down. This is because strings can get too long.\n * @param detachBitmap - detach the bitmap after conversion (default: false). This will free up bitmap memory if you don't need it anymore.\n * @param type - mime type of the data url (default: 'image/png')\n *\n * See also {@link imageUrlToImageData}, {@link imageBitmapToCanvas}, {@link imageBitmapToBlob}\n *\n * @category Images\n */\n// export function imageBitmapToBase64(bitmap: ImageBitmap | CanvasImageSource, maxWidth = 8192, detachBitmap = false, type = 'image/png'): string {\nexport function imageBitmapToBase64(bitmap: ImageBitmap | Exclude<CanvasImageSource,VideoFrame>, maxWidth = 8192, detachBitmap = false, type = 'image/png'): string {\n    if (!bitmap.width || !bitmap.height) return ''\n\n    // create a canvas\n    const canvas = imageBitmapToCanvas(bitmap, maxWidth, false)\n    // get it back as a Blob\n    const url = canvas.toDataURL(type)\n    canvas.remove()\n    if (detachBitmap && bitmap instanceof ImageBitmap) {\n        bitmap.close()\n    }\n    return url\n\n}\n\n\n/**\n * Convert an image {@link ImageBitmap} or {@link CanvasImageSource} to a blob.\n * @param bitmap - image to convert\n * @param maxWidth - maximum width of the image (default: 8192). Images larger than this will be scaled down. This is because strings can get too long.\n * @param detachBitmap - detach the bitmap after conversion (default: false). This will free up bitmap memory if you don't need it anymore.\n * @param type - mime type of the blob (default: 'image/png')\n *\n * See also {@link imageUrlToImageData}, {@link imageBitmapToCanvas}, {@link imageBitmapToBase64}\n *\n * @category Images\n */\n// export async function imageBitmapToBlob(bitmap: ImageBitmap | CanvasImageSource, maxWidth = 8192, detachBitmap = false, type = 'image/png'): Promise<Blob> {\nexport async function imageBitmapToBlob(bitmap: ImageBitmap | Exclude<CanvasImageSource,VideoFrame>, maxWidth = 8192, detachBitmap = false, type = 'image/png'): Promise<Blob> {\n    if (!bitmap.width || !bitmap.height) return Promise.reject('Invalid bitmap')\n\n    // create a canvas\n    const canvas = imageBitmapToCanvas(bitmap, maxWidth, false)\n    // get it back as a Blob\n    return new Promise<Blob>((resolve, reject) => {\n        canvas.toBlob((blob) => {\n            if (!blob) reject('Could not get blob')\n            else resolve(blob)\n            canvas.remove()\n            if (detachBitmap && bitmap instanceof ImageBitmap) {\n                bitmap.close()\n            }\n        }, type)\n    })\n}\n\n/**\n * Downloads/parse the image from an url/data url and draw to an {@link ImageData} object.\n * @param url - url or data url of the image\n * @returns ImageData object\n *\n * See also {@link imageBitmapToBase64}\n *\n * @category Images\n */\nexport async function imageUrlToImageData(url: string): Promise<ImageData> {\n    return new Promise<ImageData>((resolve, reject) => {\n        const image = new Image()\n        image.addEventListener('load', () => {\n            const canvas = document.createElement('canvas')\n            canvas.width = image.width\n            canvas.height = image.height\n            const context = canvas.getContext('2d')\n            if (!context) {\n                reject(new Error('Could not get 2d context'))\n                return\n            }\n            context.drawImage(image, 0, 0, canvas.width, canvas.height)\n            const imageData = context.getImageData(0, 0, canvas.width, canvas.height)\n            resolve(imageData)\n            // how do i return this?\n            canvas.remove()\n            image.remove()\n        }, false)\n        image.addEventListener('error', (e) => {\n            image.remove()\n            reject(e)\n        }, false)\n        image.src = url\n    })\n}\n\n/**\n * Options for {@link imageToCanvas}.\n */\nexport interface ImageCanvasOptions{\n    width: number,\n    height: number,\n    backgroundColor?: string,\n    scale?: number,\n}\n\n/**\n * Converts an HTML image to a canvas. This creates a new canvas element and draws the image on it.\n * @param image - image to convert\n * @param backgroundColor - background color of the canvas\n * @param scale - scale of the canvas\n * @param width - width of the canvas\n * @param height - height of the canvas\n * @returns a new canvas element\n *\n * @category Images\n */\nexport function imageToCanvas(image: HTMLImageElement, {\n    backgroundColor = '',\n    scale = 1,\n    width = 512,\n    height = 512,\n}: ImageCanvasOptions) {\n\n    const canvas = document.createElement('canvas')\n    const context = canvas.getContext('2d')!\n    const ratio = scale\n\n    const canvasWidth = width\n    const canvasHeight = height\n\n    canvas.width = canvasWidth * ratio\n    canvas.height = canvasHeight * ratio\n\n    canvas.style.width = `${canvasWidth}`\n    canvas.style.height = `${canvasHeight}`\n\n    if (backgroundColor?.length > 0) {\n        context.fillStyle = backgroundColor\n        context.fillRect(0, 0, canvas.width, canvas.height)\n    }\n\n    context.drawImage(image, 0, 0, canvas.width, canvas.height)\n\n    return canvas\n}\n\n/**\n * Converts an {@link ImageData} to a canvas. This creates a new canvas element and draws the image data on it.\n * Image Data can be created from image pixels like from gl.readPixels\n * This can be used to convert a WebGL texture/render target to a canvas/data url.\n * Note: if the output is flipped, use {@link canvasFlipY} after this, like `canvasFlipY(imageDataToCanvas(imageData))`\n * @param data - image data to convert\n */\nexport function imageDataToCanvas(data: ImageData){\n    const canvas = document.createElement('canvas')\n    canvas.width = data.width\n    canvas.height = data.height\n    const context = canvas.getContext('2d')!\n    context.putImageData(data, 0, 0)\n    return canvas\n}\n\n\n/**\n * Check if the browser supports exporting to webp, with the canvas.toDataURL('image/webp') method.\n */\nexport function isWebpExportSupported() {\n    const elem = document.createElement('canvas')\n\n    if (elem.getContext && elem.getContext('2d')) {\n        // was able or not to get WebP representation\n        return elem.toDataURL('image/webp').startsWith('data:image/webp')\n    } else {\n        // very old browser like IE 8, canvas not supported\n        return false\n    }\n}\n\n/**\n * Returns a new canvas with the image/canvas-content flipped vertically.\n * Useful for putImageData(as it does not respect scale and translate) and WebGL textures, which are flipped vertically.\n * @param canvas\n */\n// export function canvasFlipY(canvas: Exclude<CanvasImageSource,SVGImageElement>): HTMLCanvasElement {\nexport function canvasFlipY(canvas: Exclude<CanvasImageSource,SVGImageElement|VideoFrame>): HTMLCanvasElement {\n    const newCanvas = document.createElement('canvas')\n    newCanvas.width = canvas.width\n    newCanvas.height = canvas.height\n    const ctx = newCanvas.getContext('2d')\n    if (!ctx) throw new Error('Unable to get 2d context')\n    ctx.translate(0, canvas.height)\n    ctx.scale(1, -1)\n    ctx.drawImage(canvas, 0, 0)\n    return newCanvas\n}\n\n/**\n * Load a Blob or a file containing an image and return an HTMLImageElement.\n * @param blob\n */\nexport function blobToImage(blob: Blob){\n    return new Promise<HTMLImageElement>((resolve, reject) => {\n        const img = new Image()\n        const url = URL.createObjectURL(blob)\n        img.onload = () => {\n            URL.revokeObjectURL(url)\n            resolve(img)\n        }\n        img.onerror = (e)=>{\n            URL.revokeObjectURL(url)\n            reject(e)\n        }\n        img.src = url\n    })\n}\n","import {ImageCanvasOptions, imageToCanvas} from \"./image\";\nimport {createImage} from \"./dom\";\n\n/**\n * Returns a data url for a 16x16 svg rectangle with the given color.\n * @param c - color\n *\n * @category SVGs\n */\nexport const makeColorSvg = (c: string): string => {\n    return `data:image/svg+xml,%3Csvg width='16' height='16' viewBox='0 0 16 16' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Crect width='16' height='16' fill='%23${c}'/%3E%3C/svg%3E%0A`\n}\n/**\n * Returns a data url for a 16x16 svg circle with the given color.\n * @param c - color\n *\n * @category SVGs\n */\nexport const makeColorSvgCircle = (c: string): string => {\n    return `data:image/svg+xml,%3Csvg width='16' height='16' viewBox='0 0 16 16' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Ccircle cx='8' cy='8' r='7' fill='%23${c}'/%3E%3C/svg%3E%0A`\n}\n\n/**\n * Returns a data url for a svg with the given text.\n * @param text\n *\n * @category SVGs\n */\nexport const makeTextSvg = (text: string): string => {\n    return `data:image/svg+xml,%3Csvg viewBox='0 0 80 14' xmlns='http://www.w3.org/2000/svg'%3E%3Ctext style='font: 8px \"Roboto Mono\", \"Source Code Pro\", Menlo, Courier, monospace; fill: white;' x='9' y='9'%3E${text}%3C/text%3E%3C/svg%3E%0A`\n}\n\n/**\n * Renders an SVG to a canvas.\n * @param svgDataUrl - data url of the svg. Can be created with {@link svgUrl}\n * @param options - options\n *\n * @category SVGs\n */\nexport const svgToCanvas = async(svgDataUrl: string, options: ImageCanvasOptions): Promise<HTMLCanvasElement> => {\n    const image = await createImage(svgDataUrl)\n    return imageToCanvas(image, options)\n}\n\n/**\n * Renders an SVG to a png data url.\n * @param svgDataUrl - data url of the svg. Can be created with {@link svgUrl}\n * @param options - options\n *\n * @category SVGs\n */\nexport const svgToPng = async(svgDataUrl: string, options: ImageCanvasOptions): Promise<string> => {\n    return await svgToCanvas(svgDataUrl, options).then(canvas => canvas.toDataURL('image/png'))\n}\n","import {ImageCanvasOptions} from \"./image\";\nimport {svgToCanvas, svgToPng} from \"./svg\";\nimport {blobToDataURL} from \"./browser\";\nimport {svgUrl} from './template-literals'\n\nconst defaultDownloader = async(url: string) => blobToDataURL(await (await fetch(url)).blob())\n\n/**\n * Find all URLs in svg, download them and replace with the URL in svg with the downloaded data URLs.\n * @param str - string\n * @param downloader - function to download the URLs in svg and return the data URL\n *\n * @category HTML To Image\n */\nexport async function embedUrlRefs(str: string, downloader: (p: string) => Promise<string> = defaultDownloader) {\n    const urls = str.match(/(((ftp|https?):\\/\\/)[\\-\\w@:%_\\+.~#?,&\\/\\/=]+)/g)\n    if (urls) {\n        for (const url of urls) {\n            const dataUrl = await downloader(url)\n            str = str.replace(url, dataUrl)\n        }\n    }\n    return str\n}\n\n/**\n * Embeds an HTML string into a svg tag and converts to svg string or svg as data url\n * @param html - HTML string\n * @param style - CSS string\n * @param width - width of the svg\n * @param height - height of the svg\n * @param toDataUrl - if true, returns a data url, otherwise returns the svg string\n * @returns svg string or svg as data url\n *\n * @category HTML To Image\n */\nexport function htmlToSvg(html: string, style: string, {width, height}: {width: number, height: number}, toDataUrl = true): string {\n    const s = `\n<svg viewBox=\"0 0 ${width} ${height}\" xmlns=\"http://www.w3.org/2000/svg\">\n    <style>\n    ${style}\n    </style>\n    <foreignObject x=\"0\" y=\"0\" width=\"100%\" height=\"100%\">\n        <div xmlns=\"http://www.w3.org/1999/xhtml\" style=\"height: 100%; width: 100%; position: absolute: top:0; left:0\">\n            ${html}\n        </div>\n    </foreignObject>\n</svg>\n    `\n    return toDataUrl ? svgUrl(s) : s\n}\n\n/**\n * Renders an HTML string to a canvas. This is done by first embedding HTML into a svg and then rendering the svg to a canvas.\n * @param html - HTML string\n * @param style - CSS string\n * @param options - options for rendering the canvas\n * @returns HTML canvas element\n *\n * @category HTML To Image\n */\nexport async function htmlToCanvas(html: string, style: string, options: ImageCanvasOptions): Promise<HTMLCanvasElement> {\n    const svg = htmlToSvg(html, style, options)\n    return await svgToCanvas(svg, options)\n}\n\n/**\n * Renders an HTML string to a png. This is done by first embedding HTML into a svg and then rendering the svg to a png.\n * @param html\n * @param style\n * @param options\n * @returns png as data url\n *\n * @category HTML To Image\n */\nexport async function htmlToPng(html: string, style: string, options: ImageCanvasOptions): Promise<string> {\n    const svg = htmlToSvg(html, style, options)\n    return await svgToPng(svg, options)\n}\n","/**\n * Returns the number which is larger in absolute value.\n * @param a\n * @param b\n *\n * @category Maths\n */\nexport function absMax(a: number, b: number): number {\n    return Math.abs(a) > Math.abs(b) ? a : b\n}\n\n/**\n * Updates the bit at the given position to the given value.\n * @param number - the number to update\n * @param bitPosition - the bit position to update from the least significant bit (0) to most significant bit (31)\n * @param bitValue - 0 or 1\n */\nexport function updateBit(number: number, bitPosition: number, bitValue: number): number {\n    const bitValueNormalized = bitValue ? 1 : 0\n    const clearMask = ~(1 << bitPosition)\n    return (number & clearMask) | (bitValueNormalized << bitPosition)\n}\n\n/**\n * Clears the bit at the given position.\n * @param number - the number to update\n * @param bitPosition - the bit position to update from the least significant bit (0) to most significant bit (31)\n */\nexport function clearBit(number: number, bitPosition: number): number {\n    const clearMask = ~(1 << bitPosition)\n    return number & clearMask\n}\n\n/**\n * Generate a UUID v4\n * https://stackoverflow.com/a/53723395/2229899\n */\nexport function uuidV4(){\n    const ho = (n: number, p: number) => n.toString(16).padStart(p, '0'); /// Return the hexadecimal text representation of number `n`, padded with zeroes to be of length `p`\n    const data = crypto.getRandomValues(new Uint8Array(16)); /// Fill the buffer with random data\n    data[6] = (data[6] & 0xf) | 0x40; /// Patch the 6th byte to reflect a version 4 UUID\n    data[8] = (data[8] & 0x3f) | 0x80; /// Patch the 8th byte to reflect a variant 1 UUID (version 4 UUIDs are)\n    const view = new DataView(data.buffer); /// Create a view backed by the 16-byte buffer\n    return `${ho(view.getUint32(0), 8)}-${ho(view.getUint16(4), 4)}-${ho(view.getUint16(6), 4)}-${ho(view.getUint16(8), 4)}-${ho(view.getUint32(10), 8)}${ho(view.getUint16(14), 4)}`; /// Compile the canonical textual form from the array data\n}\n","/**\n * Get URL query parameter. If not found, return default value. Similar to PHP's $_GET\n * @param p - parameter name to get\n * @param def - default value if parameter not found\n *\n * @category URL\n */\nexport function getUrlQueryParam(p: string, def: any = null) {\n    const url = new URL(window.location.href)\n    return url.searchParams.get(p) ?? def\n}\n\n/**\n * Set URL query parameter. If value is null, remove parameter. Similar to PHP's $_GET\n * @param p - parameter name to set\n * @param v - parameter value or null to remove\n * @param reload - reload page after setting parameter, default false. If false, `history.replaceState` is used.\n *\n * @category URL\n */\nexport function setUrlQueryParam(p: string, v: string|null, reload = false) { // pass v = null to remove\n    const params = new URLSearchParams(location.search)\n    if (v === null || v === undefined) {\n        if (params.has(p))\n            params.delete(p)\n    } else params.set(p, v)\n    if (!reload)\n        window.history.replaceState({}, '', '?' + params.toString()) // todo: check if default state and set to /\n    else\n        window.location.search = params.toString()\n}\n\n\n/**\n * Join path parts with separator. Similar to PHP's pathJoin\n * @param parts - path parts\n * @param separator - separator, default '/'\n */\nexport function pathJoin(parts: string[], separator: string = '/'): string {\n    // const replace = new RegExp(separator + '{1,}', 'g')\n    return parts.join(separator)// .replace(replace, separator) //todo fix: replace breaks https://raw to https:/raw\n}\n\n/**\n * Returns a blob:// URL which points to a javascript file which will call importScripts with the given URL, to be used for cross-origin workers.\n * https://stackoverflow.com/questions/21913673/execute-web-worker-from-different-origin\n * @param url - URL to the worker js file\n * @param wasmURL - optional wasm file URL, will be passed to a created Module.locateFile (for emscripten)\n */\nexport function remoteWorkerURL(url: string, wasmURL?: string) {\n    const content = (wasmURL ? `var Module = { locateFile: function(s) { return \"${ wasmURL }\"; } }; \\n` : '')\n        + `importScripts( \"${ url }\" );`\n    return URL.createObjectURL(new Blob([content], {type: 'text/javascript'}))\n}\n"],"names":["SimpleEventDispatcher","type","listener","listeners","listenerArray","index","event","array","i","l","timeout","duration","resolve","now","PointerDragHelper","x","y","time","value","_a","_b","_c","_d","_e","JSUndoManager","options","e","ctrlKey","command","last","command1","doFunction","p","exceedsBy","limit","redoable","msg","args","_Damper","decayMilliseconds","v","vGoal","timeStepMilliseconds","xNormalization","nilSpeed","deltaV","intermediateVelocity","intermediateX","decay","newVelocity","acceleration","Damper","createCanvasElement","canvas","createDiv","innerHTML","id","classList","addToBody","elementTag","elem","createImage","url","reject","img","createStyles","styles","root","styleSheet","createScriptFromURL","s","setInnerHTMLWithScripts","element","html","scripts","script","newScript","cloneScriptTag","err","j","attr","arrayBufferToBase64","buffer","binary","bytes","len","base64ToArrayBuffer","base64","binaryString","TYPED_ARRAYS","getTypedArray","toTitleCase","str","txt","toCamelCase","$1","parseFileExtension","path","basename","pos","getFilenameFromPath","escapeRegExp","replaceAll","find","replace","safeReplaceString","source","newStr","prepend","append","notFoundCallback","longestCommonPrefix","words","char","idx","glsl","strings","rest","css","svgUrl","encoded","prettyScrollbar","downloadBlob","b","name","a","blobToDataURL","blob","reader","downloadFile","uploadFile","multiple","directory","accept","input","files","mobileAndTabletCheck","check","SRGBToLinear","c","LinearToSRGB","colorToDataUrl","color","width","height","ctx","getPropertyDescriptor","obj","prop","desc","isPropertyWritable","object","allowWritable","allowAny","safeSetProperty","getOrCall","copyProps","dest","propList","includesAll","arr","subArr","sub","findLastIndex","predicate","wrapThisFunction","f1","f2","wrapThisFunction2","deepAccessObject","access","tar","throwOnInvalid","getKeyByValue","key","objectHasOwn","o","objectMap","fn","inPlace","result","keys","objectMap2","objSerializer","meta","k","Serialization","data","_Serialization","serializers","serializer","priority","isThis","res","Type","propKey","constructor","current","newVal","d","de","_FnCaller","params","methods","descp","FnCaller","onChange","fnKey","paramType","targetPrototype","propertyKey","descriptor","oldVal","onChange2","onChange3","onChangeDispatchEvent","eventName","oldValue","target","serialize","serializable","aesGcmEncrypt","content","password","prefix","pwUtf8","pwHash","iv","ivStr","alg","ptUint8","ctBuffer","ctUint","ctArray","ctStr","byte","prefixStr","prefixArray","aesGcmDecrypt","ciphertext","ch","ctUint8","plainBuffer","getFileHandle","handles","getNewFileHandle","opts","readFile","file","_readFileLegacy","text","writeFile","fileHandle","contents","writer","writable","verifyPermission","withWrite","imageBitmapToCanvas","bitmap","maxWidth","detachBitmap","isBitmap","imageBitmapToBase64","imageBitmapToBlob","imageUrlToImageData","image","context","imageData","imageToCanvas","backgroundColor","scale","ratio","canvasWidth","canvasHeight","imageDataToCanvas","isWebpExportSupported","canvasFlipY","newCanvas","blobToImage","makeColorSvg","makeColorSvgCircle","makeTextSvg","svgToCanvas","svgDataUrl","svgToPng","defaultDownloader","embedUrlRefs","downloader","urls","dataUrl","htmlToSvg","style","toDataUrl","htmlToCanvas","svg","htmlToPng","absMax","updateBit","number","bitPosition","bitValue","bitValueNormalized","clearMask","clearBit","uuidV4","ho","n","view","getUrlQueryParam","def","setUrlQueryParam","reload","pathJoin","parts","separator","remoteWorkerURL","wasmURL"],"mappings":"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"}